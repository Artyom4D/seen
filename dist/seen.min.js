!function(){var t,r,n,e,i,o,s,u,a,h,p,c,l,f,y,d,m,_,g,v=function(t,r){return function(){return t.apply(r,arguments)}},x={}.hasOwnProperty,b=function(t,r){function n(){this.constructor=t}for(var e in r)x.call(r,e)&&(t[e]=r[e]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},w=this;h=null!=(p="undefined"!=typeof exports&&null!==exports?exports:this).seen?(p="undefined"!=typeof exports&&null!==exports?exports:this).seen:p.seen={},h.Util={defaults:function(t,r,n){var e,i;for(e in r)null==t[e]&&(t[e]=r[e]);i=[];for(e in n)null==t[e]?i.push(t[e]=n[e]):i.push(void 0);return i},arraysEqual:function(t,r){var n,e,i,o;if(!t.length===r.length)return!1;for(n=i=0,o=t.length;o>i;n=++i)if(e=t[n],e!==r[n])return!1;return!0}},t=new Array(16),i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h.Matrix=function(){function r(t){return this.m=null!=t?t:null,null==this.m&&(this.m=i.slice()),this}return r.prototype.copy=function(){return new h.Matrix(this.m.slice())},r.prototype.reset=function(){return this.m=i.slice(),this},r.prototype.multiply=function(t){return this.copy()._multiply(t)},r.prototype.multiplyM=function(t){return this.copy()._multiplyM(t)},r.prototype.rotx=function(t){return this.copy()._rotx(t)},r.prototype.roty=function(t){return this.copy()._roty(t)},r.prototype.rotz=function(t){return this.copy()._rotz(t)},r.prototype.translate=function(t,r,n){return this.copy()._translate(t,r,n)},r.prototype.scale=function(t,r){return this.copy()._scale(t,r,t)},r.prototype._multiply=function(t){return this._multiplyM(t.m)},r.prototype._multiplyM=function(r){var n,e,i,o,s;for(n=t,i=o=0;4>o;i=++o)for(e=s=0;16>s;e=s+=4)n[e+i]=r[e]*this.m[i]+r[e+1]*this.m[4+i]+r[e+2]*this.m[8+i]+r[e+3]*this.m[12+i];return t=this.m,this.m=n,this},r.prototype._rotx=function(t){var r,n,e;return r=Math.cos(t),e=Math.sin(t),n=[1,0,0,0,0,r,-e,0,0,e,r,0,0,0,0,1],this._multiplyM(n)},r.prototype._roty=function(t){var r,n,e;return r=Math.cos(t),e=Math.sin(t),n=[r,0,e,0,0,1,0,0,-e,0,r,0,0,0,0,1],this._multiplyM(n)},r.prototype._rotz=function(t){var r,n,e;return r=Math.cos(t),e=Math.sin(t),n=[r,-e,0,0,e,r,0,0,0,0,1,0,0,0,0,1],this._multiplyM(n)},r.prototype._translate=function(t,r,n){return null==t&&(t=0),null==r&&(r=0),null==n&&(n=0),this.m[3]+=t,this.m[7]+=r,this.m[11]+=n,this},r.prototype._scale=function(t,r,n){return null==t&&(t=1),null==r&&(r=t),null==n&&(n=r),this.m[0]*=t,this.m[5]*=r,this.m[10]*=n,this},r}(),h.M=function(t){return new h.Matrix(t)},h.Matrices={identity:h.M(),flipX:h.M().scale(-1,1,1),flipY:h.M().scale(1,-1,1),flipZ:h.M().scale(1,1,-1)},h.Transformable=function(){function t(){this.m=new h.Matrix}return t.prototype.scale=function(t,r,n){return this.m._scale(t,r,n),this},t.prototype.translate=function(t,r,n){return this.m._translate(t,r,n),this},t.prototype.rotx=function(t){return this.m._rotx(t),this},t.prototype.roty=function(t){return this.m._roty(t),this},t.prototype.rotz=function(t){return this.m._rotz(t),this},t.prototype.matrix=function(t){return this.m._multiplyM(t),this},t.prototype.transform=function(t){return this.m._multiply(t),this},t.prototype.reset=function(){return this.m.reset(),this},t}(),h.Point=function(){function t(t,r,n,e){this.x=null!=t?t:0,this.y=null!=r?r:0,this.z=null!=n?n:0,this.w=null!=e?e:1}return t.prototype.transform=function(t){var r;return r=o,r.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],r.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],r.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],r.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(r),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copy=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.normalize=function(){return this.copy()._normalize()},t.prototype.add=function(t){return this.copy()._add(t)},t.prototype.subtract=function(t){return this.copy()._subtract(t)},t.prototype.cross=function(t){return this.copy()._cross(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.multiply=function(t){return this.copy()._multiply(t)},t.prototype.divide=function(t){return this.copy()._divide(t)},t.prototype._multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype._divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype._normalize=function(){var t;return t=Math.sqrt(this.dot(this)),0===t?this.set(Points.Z):this._divide(t),this},t.prototype._add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype._subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype._cross=function(t){var r;return r=o,r.x=this.y*t.z-this.z*t.y,r.y=this.z*t.x-this.x*t.z,r.z=this.x*t.y-this.y*t.x,this.set(r),this},t.prototype.toJSON=function(){return[this.x,this.y,this.z,this.w]},t}(),h.P=function(t,r,n,e){return new h.Point(t,r,n,e)},o=h.P(),h.Points={X:h.P(1,0,0),Y:h.P(0,1,0),Z:h.P(0,0,1),ZERO:h.P(0,0,0)},h.Color=function(){function t(t,r,n,e){this.r=null!=t?t:0,this.g=null!=r?r:0,this.b=null!=n?n:0,this.a=null!=e?e:255}return t.prototype.hex=function(){var t;for(t=(this.r<<16|this.g<<8|this.b).toString(16);t.length<6;)t="0"+t;return"#"+t},t.prototype.style=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t}(),h.Colors={rgb:function(t,r,n,e){return new h.Color(t,r,n,e)},hex:function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new h.Color(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},hsl:function(t,r,n){var e,i,o,s,u,a;return a=i=e=0,0===r?a=i=e=n:(o=function(t,r,n){return 0>n?n+=1:n>1&&(n-=1),1/6>n?t+6*(r-t)*n:.5>n?r:2/3>n?t+6*(r-t)*(2/3-n):t},u=.5>n?n*(1+r):n+r-n*r,s=2*n-u,a=o(s,u,t+1/3),i=o(s,u,t),e=o(s,u,t-1/3)),new h.Color(255*a,255*i,255*e)}},h.C=h.Colors,h.C.black=h.C.hex("#000000"),h.C.white=h.C.hex("#FFFFFF"),h.C.gray=h.C.hex("#888888"),h.Material=function(){function t(t){this.color=t,h.Util.defaults(this,{},this.defaults)}return t.prototype.defaults={color:h.C.gray,specularColor:h.C.white,specularExponent:8,shader:null},t.prototype.render=function(t,r,n){var e,i;return e=null!=(i=this.shader)?i:r,e.shade(t,n,this)},t}(),h.Light=function(t){function r(t){this.transform=v(this.transform,this),h.Util.defaults(this,t,{point:h.P(),color:h.C.white,intensity:.01})}return b(r,t),r.prototype.transform=function(t){return this.point.transform(t)},r}(h.Transformable),h.Shader=function(){function t(){}return t.prototype.shade=function(){},t}(),u=function(t){function r(){return l=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.shade=function(t,r,n){var e,i,o,s,u,a,p,c,l,f,y,d;for(o=new h.Color,y=t.points,p=0,l=y.length;l>p;p++)u=y[p],e=u.point.subtract(r.barycenter).normalize(),s=e.dot(r.normal),s>0&&(o.r+=u.color.r*s*u.intensity,o.g+=u.color.g*s*u.intensity,o.b+=u.color.b*s*u.intensity,i=r.normal.multiply(2*s).subtract(e),a=Math.pow(1+i.dot(h.Points.Z),n.specularExponent),o.r+=a*u.intensity,o.g+=a*u.intensity,o.b+=a*u.intensity);for(d=t.ambients,c=0,f=d.length;f>c;c++)u=d[c],o.r+=u.color.r*u.intensity,o.g+=u.color.g*u.intensity,o.b+=u.color.b*u.intensity;return o.r=Math.min(255,n.color.r*o.r),o.g=Math.min(255,n.color.g*o.g),o.b=Math.min(255,n.color.b*o.b),o},r}(h.Shader),n=function(t){function r(){return f=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.shade=function(t,r,n){var e,i,o,s,u,a,p,c,l,f;for(i=new h.Color,l=t.points,u=0,p=l.length;p>u;u++)s=l[u],e=s.point.subtract(r.barycenter).normalize(),o=e.dot(r.normal),o>0&&(i.r+=s.color.r*o*s.intensity,i.g+=s.color.g*o*s.intensity,i.b+=s.color.b*o*s.intensity);for(f=t.ambients,a=0,c=f.length;c>a;a++)s=f[a],i.r+=s.color.r*s.intensity,i.g+=s.color.g*s.intensity,i.b+=s.color.b*s.intensity;return i.r=Math.min(255,n.color.r*i.r),i.g=Math.min(255,n.color.g*i.g),i.b=Math.min(255,n.color.b*i.b),i},r}(h.Shader),r=function(t){function r(){return y=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.shade=function(t,r,n){var e,i,o,s,u;for(e=new h.Color,u=t.ambients,o=0,s=u.length;s>o;o++)i=u[o],e.r+=i.color.r*i.intensity,e.g+=i.color.g*i.intensity,e.b+=i.color.b*i.intensity;return e.r=Math.min(255,n.color.r*e.r),e.g=Math.min(255,n.color.g*e.g),e.b=Math.min(255,n.color.b*e.b),e},r}(h.Shader),e=function(t){function r(){return d=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.shade=function(t,r,n){return n.color},r}(h.Shader),h.Shaders={phong:new u,diffuse:new n,ambient:new r,flat:new e},h.RenderSurface=function(){function t(t,r,n){this.points=t,this.transform=r,this.projection=n,this.transformed=this._initRenderData(),this.projected=this._initRenderData(),this._update()}return t.prototype.update=function(t,r){return h.Util.arraysEqual(t.m,this.transform.m)&&h.Util.arraysEqual(r.m,this.projection.m)?void 0:(this.transform=t,this.projection=r,this._update())},t.prototype._update=function(){return this._math(this.transformed,this.points,this.transform,!1),this._math(this.projected,this.transformed.points,this.projection,!0)},t.prototype._initRenderData=function(){var t;return{points:function(){var r,n,e,i;for(e=this.points,i=[],r=0,n=e.length;n>r;r++)t=e[r],i.push(t.copy());return i}.call(this),barycenter:h.P(),normal:h.P(),v0:h.P(),v1:h.P()}},t.prototype._math=function(t,r,n,e){var i,o,s,u,a,p,c,l;for(null==e&&(e=!1),i=u=0,p=r.length;p>u;i=++u)o=r[i],s=t.points[i],s.set(o).transform(n),e&&s._divide(s.w);for(t.barycenter.set(h.Points.ZERO),l=t.points,a=0,c=l.length;c>a;a++)o=l[a],t.barycenter._add(o);return t.barycenter._divide(t.points.length),t.v0.set(t.points[1])._subtract(t.points[0]),t.v1.set(t.points[r.length-1])._subtract(t.points[0]),t.normal.set(t.v0._cross(t.v1)._normalize())},t}(),h.Surface=function(){function t(t,r){this.points=t,this.painter=null!=r?r:h.Painters.path,this.updateRenderData=v(this.updateRenderData,this)}return t.prototype.cullBackfaces=!0,t.prototype.fill=new h.Material(h.C.gray),t.prototype.stroke=null,t.prototype.updateRenderData=function(t,r){return null==this.render?this.render=new h.RenderSurface(this.points,t,r):this.render.update(t,r),this.render},t}(),h.Shape=function(t){function r(t,n){this.type=t,this.surfaces=n,r.__super__.constructor.call(this)}return b(r,t),r.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},r.prototype.fill=function(t){return this.eachSurface(function(r){return r.fill=t}),this},r.prototype.stroke=function(t){return this.eachSurface(function(r){return r.stroke=t}),this},r}(h.Transformable),h.Group=function(t){function r(){r.__super__.constructor.call(this),this.children=[]}return b(r,t),r.prototype.add=function(t){return this.children.push(t),this},r.prototype.append=function(){var t;return t=new h.Group,this.add(t),t},r.prototype.eachShape=function(t){var r,n,e,i,o;for(i=this.children,o=[],n=0,e=i.length;e>n;n++)r=i[n],r instanceof h.Shape&&t.call(this,r),r instanceof h.Group?o.push(r.eachTransformedShape(t)):o.push(void 0);return o},r.prototype.eachTransformedShape=function(t,r){var n,e,i,o,s;for(null==r&&(r=null),null==r&&(r=this.m),o=this.children,s=[],e=0,i=o.length;i>e;e++)n=o[e],n instanceof h.Shape&&t.call(this,n,n.m.multiply(r)),n instanceof h.Group?s.push(n.eachTransformedShape(t,n.m.multiply(r))):s.push(void 0);return s},r}(h.Transformable),h.Painter=function(){function t(){}return t.prototype.paint=function(){},t}(),s=function(t){function r(){return m=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.paint=function(t,r){var n,e;return n=t.render,r.path().path(n.projected.points).style({fill:null==n.fill?"none":n.fill.hex(),stroke:null==n.stroke?"none":n.stroke.hex(),"fill-opacity":null==t.fill?1:t.fill.a/255,"stroke-width":null!=(e=t["stroke-width"])?e:1})},r}(h.Painter),a=function(t){function r(){return _=r.__super__.constructor.apply(this,arguments)}return b(r,t),r.prototype.paint=function(t,r){var n,e;return n=t.render,r.text().text(t.text).transform(n.transform.multiply(n.projection)).style({fill:null==n.fill?"none":n.fill.hex(),stroke:null==n.stroke?"none":n.stroke.hex(),"text-anchor":null!=(e=t.anchor)?e:"middle"})},r}(h.Painter),h.Painters={path:new s,text:new a},h.Shapes={_cubeCoordinateMap:[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],_mapPointsToSurfaces:function(t,r){var n,e,i,o,s,u;for(o=[],s=0,u=r.length;u>s;s++)e=r[s],i=function(){var r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(t[n].copy());return o}(),o.push(new h.Surface(i));return o},joints:function(t,r){var n,e,i,o;for(null==r&&(r=this.unitcube),n=new h.Group,i=[],e=o=0;t>=0?t>o:o>t;e=t>=0?++o:--o)i.push(n),n=n.append().translate(-.5,-1,-.5).add(r()).append().translate(.5,0,.5).append();return i},bipedSkeleton:function(t){var r,n,e,i,o;return null==t&&(t=w.unitcube),i=function(){var r;return r=w.joints(3,t),{upperBody:r[0],torso:r[1],pelvis:r[2]}},n=function(){var r;return r=w.joints(4,t),{shoulder:r[0],upperArm:r[1],elbow:r[2],foreArm:r[3]}},e=function(){var r;return r=w.joints(4,t),{upperLeg:r[0],knee:r[1],lowerLeg:r[2],foot:r[3]}},r=function(t,r,n){var e;return e=t.append().translate(n).append(),e.append().translate(n).add(r),e},o=i(),o.root=o.upperBody,o.leftArm=n(),o.rightArm=n(),o.leftLeg=e(),o.rightLeg=e(),o.leftShoulder=r(o.upperBody,o.leftArm.shoulder,.5),o.rightShoulder=r(o.upperBody,o.rightArm.shoulder,-.5),o.leftHip=r(o.pelvis,o.leftLeg.upperLeg,.5),o.rightHip=r(o.pelvis,o.rightLeg.upperLeg,-.5),o},cube:function(){var t;return t=[h.P(-1,-1,-1),h.P(-1,-1,1),h.P(-1,1,-1),h.P(-1,1,1),h.P(1,-1,-1),h.P(1,-1,1),h.P(1,1,-1),h.P(1,1,1)],new h.Shape("cube",h.Shapes._mapPointsToSurfaces(t,h.Shapes._cubeCoordinateMap))},unitcube:function(){var t;return t=[h.P(0,0,0),h.P(0,0,1),h.P(0,1,0),h.P(0,1,1),h.P(1,0,0),h.P(1,0,1),h.P(1,1,0),h.P(1,1,1)],new h.Shape("unitcube",h.Shapes._mapPointsToSurfaces(t,h.Shapes._cubeCoordinateMap))},rectangle:function(t,r){var n,e;return n=function(n,e,i){return h.P(n(t.x,r.x),e(t.y,r.y),i(t.z,r.z))},e=[n(Math.min,Math.min,Math.min),n(Math.min,Math.min,Math.max),n(Math.min,Math.max,Math.min),n(Math.min,Math.max,Math.max),n(Math.max,Math.min,Math.min),n(Math.max,Math.min,Math.max),n(Math.max,Math.max,Math.min),n(Math.max,Math.max,Math.max)],new h.Shape("rect",h.Shapes._mapPointsToSurfaces(e,h.Shapes._cubeCoordinateMap))},tetrahedron:function(){var t,r;return r=[h.P(1,1,1),h.P(-1,-1,1),h.P(-1,1,-1),h.P(1,-1,-1)],t=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],new h.Shape("tetrahedron",h.Shapes._mapPointsToSurfaces(r,t))},text:function(t){var r;return r=new h.Surface([h.P(0,0,-1),h.P(0,20,-1),h.P(20,0,-1)],h.Painters.text),r.text=t,r.cullBackfaces=!1,new h.Shape("text",[r])},extrude:function(t,r){var n,e,i,o,s,u,a,p;for(null==r&&(r=1),u=[],e=new h.Surface(function(){var r,n,e;for(e=[],r=0,n=t.length;n>r;r++)s=t[r],e.push(s.copy());return e}()),n=new h.Surface(function(){var n,e,i;for(i=[],n=0,e=t.length;e>n;n++)s=t[n],i.push(s.translate(0,0,r));return i}()),i=a=1,p=t.length;p>=1?p>a:a>p;i=p>=1?++a:--a)u.push(new h.Surface([e.points[i-1].copy(),n.points[i-1].copy(),n.points[i].copy(),e.points[i].copy()]));return o=t.length,u.push(new h.Surface([e.points[o-1].copy(),n.points[o-1].copy(),n.points[0].copy(),e.points[0].copy()])),n.points.reverse(),u.push(e),u.push(n),new h.Shape("extrusion",u)},arrow:function(t,r,n,e,i){var o,s;return null==t&&(t=1),null==r&&(r=1),null==n&&(n=1),null==e&&(e=1),null==i&&(i=0),o=n/2,s=[h.P(0,0,0),h.P(e+i,1,0),h.P(e,o,0),h.P(e+r,o,0),h.P(e+r,-o,0),h.P(e,-o,0),h.P(e+i,-1,0)],h.Shapes.extrude(s,t)},path:function(t){return new h.Shape("path",[new h.Surface(t)])},custom:function(t){var r,n,e,i,o,s;for(e=[],s=t.surfaces,i=0,o=s.length;o>i;i++)r=s[i],e.push(new h.Surface(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(h.P.apply(h,n));return i}()));return new h.Shape("custom",e)}},h.Projections={perspectiveFov:function(t,r){var n;return null==t&&(t=50),null==r&&(r=100),n=r*Math.tan(t*Math.PI/360),h.Projections.perspective(-n,n,-n,n,r,2*r)},orthoExtent:function(t){return null==t&&(t=100),h.Projections.ortho(-t,t,-t,t,t,2*t)},perspective:function(t,r,n,e,i,o){var s,u,a,p,c;return c=2*i,s=r-t,u=e-n,a=o-i,p=new Array(16),p[0]=c/s,p[1]=0,p[2]=(r+t)/s,p[3]=0,p[4]=0,p[5]=c/u,p[6]=(e+n)/u,p[7]=0,p[8]=0,p[9]=0,p[10]=-(o+i)/a,p[11]=-(o*c)/a,p[12]=0,p[13]=0,p[14]=-1,p[15]=0,new h.Matrix(p)},ortho:function(t,r,n,e,i,o){var s,u,a,p,c;return c=2*i,s=r-t,u=e-n,a=o-i,p=new Array(16),p[0]=2/s,p[1]=0,p[2]=0,p[3]=(r+t)/s,p[4]=0,p[5]=2/u,p[6]=0,p[7]=-(e+n)/u,p[8]=0,p[9]=0,p[10]=-2/a,p[11]=-(o+i)/a,p[12]=0,p[13]=0,p[14]=0,p[15]=1,new h.Matrix(p)}},h.Viewports={centerOrigin:function(t,r,n,e){return null==t&&(t=500),null==r&&(r=500),null==n&&(n=0),null==e&&(e=0),(new h.Matrix).scale(t/2,-r/2).translate(n+t/2,e+r/2)}},g=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},c=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),h.Renderer=function(){function t(){}return t.prototype.render=function(t){var r,n,e;for(this.reset(),n=0,e=t.length;e>n;n++)r=t[n],r.painter.paint(r,this);return this.hideUnused()},t.prototype.path=function(){},t.prototype.text=function(){},t}(),h.SvgRenderer=function(t){function r(){this._i=0}return b(r,t),r.prototype.addTo=function(t){return this._g=t},r.prototype.path=function(){var t;return t=this._manifest("path"),{el:t,path:function(r){return t.setAttribute("d",c(r)),this},style:function(r){var n,e,i;e="";for(n in r)i=r[n],e+=""+n+":"+i+";";return t.setAttribute("style",e),this}}},r.prototype.text=function(){var t;return t=this._manifest("text"),t.setAttribute("font-family","Roboto"),{el:t,text:function(r){return t.textContent=r,this},style:function(r){var n,e,i;e="";for(n in r)i=r[n],e+=""+n+":"+i+";";return t.setAttribute("style",e),this},transform:function(r){var n;return n=r.m,t.setAttribute("transform","matrix("+n[0]+" "+n[4]+" "+n[1]+" "+n[5]+" "+n[3]+" "+n[7]+")"),this}}},r.prototype.reset=function(){return this._i=0},r.prototype.hideUnused=function(){var t,r;for(t=this._g.childNodes,r=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),r.push(this._i++);return r},r.prototype._manifest=function(t){var r,n,e;return r=this._g.childNodes,this._i>=r.length?(e=g(t),this._g.appendChild(e),this._i++,e):(n=r[this._i],n.tagName===t?(this._i++,n):(e=g(t),this._g.replaceChild(e,n),this._i++,e))},r}(h.Renderer),h.SvgCanvas=function(){function t(t){this.svg=t,this.layers={}}return t.prototype.layer=function(t,r){var n;return n=this.layers[t]=g("g"),this.svg.appendChild(n),null!=r&&r.addTo(n),this},t}(),h.SvgRenderDebug=function(){function t(t){this._renderEnd=v(this._renderEnd,this),this._renderStart=v(this._renderStart,this),this._text=g("text"),this._text.setAttribute("style","text-anchor:end;"),this._text.setAttribute("x",490),this._text.setAttribute("y","20"),this._fps=30,t.on("beforeRender.debug",this._renderStart),t.on("afterRender.debug",this._renderEnd)}return t.prototype.addTo=function(t){return t.appendChild(this._text)},t.prototype._renderStart=function(){return this._renderStartTime=new Date},t.prototype._renderEnd=function(t){var r;return r=1e3/(new Date-this._renderStartTime),0/0!==r&&(this._fps+=(r-this._fps)/20),this._text.textContent="fps: "+this._fps.toFixed(1)+" surfaces: "+t.surfaces.length},t}(),h.SvgFillRect=function(){function t(){}return t.prototype.addTo=function(t){var r;return r=g("rect"),r.setAttribute("fill","#EEE"),r.setAttribute("width",500),r.setAttribute("height",500),t.appendChild(r)},t}(),h.Scene=function(){function t(t){this.renderSurfaces=v(this.renderSurfaces,this),this.render=v(this.render,this),h.Util.defaults(this,t,this.defaults),this.dispatch=d3.dispatch("beforeRender","afterRender"),d3.rebind(this,this.dispatch,["on"]),this.group=new h.Group,this.shader=h.Shaders.phong,this.lights={points:[],ambients:[]},this.surfaces=[]}return t.prototype.defaults={cullBackfaces:!0,projection:h.Projections.perspective(-100,100,-100,100,100,300),viewport:h.Viewports.centerOrigin(500,500)},t.prototype.startRenderLoop=function(t){return null==t&&(t=30),setInterval(this.render,t)},t.prototype.render=function(){var t;return this.dispatch.beforeRender(),t=this.renderSurfaces(),this.renderer.render(t),this.dispatch.afterRender({surfaces:t}),this},t.prototype.renderSurfaces=function(){var t,r=this;return t=this.projection.multiply(this.viewport),this.surfaces.length=0,this.group.eachTransformedShape(function(n,e){var i,o,s,u,a,h,p,c;for(a=n.surfaces,c=[],s=0,u=a.length;u>s;s++)o=a[s],i=o.updateRenderData(e,t),!r.cullBackfaces||!o.cullBackfaces||i.projected.normal.z<0?(i.fill=null!=(h=o.fill)?h.render(r.lights,r.shader,i.transformed):void 0,i.stroke=null!=(p=o.stroke)?p.render(r.lights,r.shader,i.transformed):void 0,c.push(r.surfaces.push(o))):c.push(void 0);return c}),this.surfaces.sort(function(t,r){return r.render.projected.barycenter.z-t.render.projected.barycenter.z}),this.surfaces},t}()}.call(this);