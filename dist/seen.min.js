(function(){var t,n,e,r,i,s,o,a,u,h,l,c,p,f,d,y,m,g,v,x,_,w,M,S,P,b=function(t,n){return function(){return t.apply(n,arguments)}},q=[].slice,C={}.hasOwnProperty,z=function(t,n){function e(){this.constructor=t}for(var r in n)C.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};y=("undefined"!=typeof exports&&null!==exports?exports:this).seen={},l=1,y.Util={defaults:function(t,n,e){var r,i;for(r in n)null==t[r]&&(t[r]=n[r]);i=[];for(r in e)null==t[r]?i.push(t[r]=e[r]):i.push(void 0);return i},arraysEqual:function(t,n){var e,r,i,s;if(!t.length===n.length)return!1;for(e=i=0,s=t.length;s>i;e=++i)if(r=t[e],r!==n[e])return!1;return!0},uniqueId:function(t){return null==t&&(t=""),t+l++},element:function(t){return"string"==typeof t?document.getElementById(t):t}},y.Events={dispatch:function(){var t,n,e,r;for(n=new y.Events.Dispatcher,e=0,r=arguments.length;r>e;e++)t=arguments[e],n[t]=y.Events.Event();return n}},y.Events.Dispatcher=function(){function t(){this.on=b(this.on,this)}return t.prototype.on=function(t,n){var e,r;return e=t.indexOf("."),r="",e>0&&(r=t.substring(e+1),t=t.substring(0,e)),null!=this[t]&&this[t].on(r,n),this},t}(),y.Events.Event=function(){var t,n,e;return e=[],n={},t=function(){var t,n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(t.apply(this,arguments));return i},t.on=function(t,r){var i,s;return i=n[t],i&&(e=e.slice(0,s=e.indexOf(i)).concat(e.slice(s+1)),delete n[t]),r?(e.push(r),n[t]=r):void 0},t},t=new Array(16),h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y.Matrix=function(){function n(t){return this.m=null!=t?t:null,null==this.m&&(this.m=h.slice()),this}return n.prototype.copy=function(){return new y.Matrix(this.m.slice())},n.prototype.reset=function(){return this.m=h.slice(),this},n.prototype.multiply=function(t){return this.matrix(t.m)},n.prototype.matrix=function(n){var e,r,i,s,o;for(e=t,i=s=0;4>s;i=++s)for(r=o=0;16>o;r=o+=4)e[r+i]=n[r]*this.m[i]+n[r+1]*this.m[4+i]+n[r+2]*this.m[8+i]+n[r+3]*this.m[12+i];return t=this.m,this.m=e,this},n.prototype.rotx=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1],this.matrix(e)},n.prototype.roty=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1],this.matrix(e)},n.prototype.rotz=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1],this.matrix(e)},n.prototype.translate=function(t,n,e){return null==t&&(t=0),null==n&&(n=0),null==e&&(e=0),this.m[3]+=t,this.m[7]+=n,this.m[11]+=e,this},n.prototype.scale=function(t,n,e){return null==t&&(t=1),null==n&&(n=t),null==e&&(e=n),this.m[0]*=t,this.m[5]*=n,this.m[10]*=e,this},n}(),y.M=function(t){return new y.Matrix(t)},y.Matrices={identity:function(){return y.M()},flipX:function(){return y.M().scale(-1,1,1)},flipY:function(){return y.M().scale(1,-1,1)},flipZ:function(){return y.M().scale(1,1,-1)}},y.Transformable=function(){function t(){var t,n,e,r,i,s=this;for(this.m=new y.Matrix,i=["scale","translate","rotx","roty","rotz","matrix","reset"],n=function(t){return s[t]=function(){var n;return(n=this.m[t]).call.apply(n,[this.m].concat(q.call(arguments))),this}},e=0,r=i.length;r>e;e++)t=i[e],n(t)}return t.prototype.transform=function(t){return this.m.multiply(t),this},t}(),y.Point=function(){function t(t,n,e,r){this.x=null!=t?t:0,this.y=null!=n?n:0,this.z=null!=e?e:0,this.w=null!=r?r:1}return t.prototype.copy=function(){return new y.Point(this.x,this.y,this.z,this.w)},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.translate=function(t,n,e){return this.x+=t,this.y+=n,this.z+=e,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},t.prototype.normalize=function(){var t;return t=Math.sqrt(this.dot(this)),0===t?this.set(y.Points.Z):this.divide(t),this},t.prototype.transform=function(t){var n;return n=c,n.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],n.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],n.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],n.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(n),this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(t){var n;return n=c,n.x=this.y*t.z-this.z*t.y,n.y=this.z*t.x-this.x*t.z,n.z=this.x*t.y-this.y*t.x,this.set(n),this},t.prototype.toJSON=function(){return[this.x,this.y,this.z,this.w]},t}(),y.P=function(t,n,e,r){return new y.Point(t,n,e,r)},c=y.P(),y.Points={X:y.P(1,0,0),Y:y.P(0,1,0),Z:y.P(0,0,1),ZERO:y.P(0,0,0)},y.Quaternion=function(){function t(){this.q=y.P.apply(y,arguments)}return t.pixelsPerRadian=150,t.xyToTransform=function(t,n){var e,r;return e=y.Quaternion.pointAngle(y.Points.Y,t/y.Quaternion.pixelsPerRadian),r=y.Quaternion.pointAngle(y.Points.X,n/y.Quaternion.pixelsPerRadian),e.multiply(r).toMatrix()},t.axisAngle=function(t,n,e,r){var i,s;return i=Math.sin(r/2),s=Math.cos(r/2),new y.Quaternion(i*t,i*n,i*e,s)},t.pointAngle=function(t,n){var e,r;return e=Math.sin(n/2),r=Math.cos(n/2),new y.Quaternion(e*t.x,e*t.y,e*t.z,r)},t.prototype.multiply=function(t){var n,e;return n=y.P(),n.w=this.q.w*t.q.w-this.q.x*t.q.x-this.q.y*t.q.y-this.q.z*t.q.z,n.x=this.q.w*t.q.x+this.q.x*t.q.w+this.q.y*t.q.z-this.q.z*t.q.y,n.y=this.q.w*t.q.y+this.q.y*t.q.w+this.q.z*t.q.x-this.q.x*t.q.z,n.z=this.q.w*t.q.z+this.q.z*t.q.w+this.q.x*t.q.y-this.q.y*t.q.x,e=new y.Quaternion,e.q=n,e},t.prototype.toMatrix=function(){var t;return t=new Array(16),t[0]=1-2*(this.q.y*this.q.y+this.q.z*this.q.z),t[1]=2*(this.q.x*this.q.y-this.q.w*this.q.z),t[2]=2*(this.q.x*this.q.z+this.q.w*this.q.y),t[3]=0,t[4]=2*(this.q.x*this.q.y+this.q.w*this.q.z),t[5]=1-2*(this.q.x*this.q.x+this.q.z*this.q.z),t[6]=2*(this.q.y*this.q.z-this.q.w*this.q.x),t[7]=0,t[8]=2*(this.q.x*this.q.z-this.q.w*this.q.y),t[9]=2*(this.q.y*this.q.z+this.q.w*this.q.x),t[10]=1-2*(this.q.x*this.q.x+this.q.y*this.q.y),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,y.M(t)},t}(),y.Color=function(){function t(t,n,e,r){this.r=null!=t?t:0,this.g=null!=n?n:0,this.b=null!=e?e:0,this.a=null!=r?r:255}return t.prototype.copy=function(){return new y.Color(this.r,this.g,this.b,this.a)},t.prototype.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this},t.prototype.offset=function(t){return this.r+=t,this.g+=t,this.b+=t,this},t.prototype.clamp=function(t,n){return null==t&&(t=0),null==n&&(n=255),this.r=Math.min(n,Math.max(t,this.r)),this.g=Math.min(n,Math.max(t,this.g)),this.b=Math.min(n,Math.max(t,this.b)),this},t.prototype.addChannels=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},t.prototype.multiplyChannels=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},t.prototype.hex=function(){var t;for(t=(this.r<<16|this.g<<8|this.b).toString(16);t.length<6;)t="0"+t;return"#"+t},t.prototype.style=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t}(),y.Colors={rgb:function(t,n,e,r){return null==r&&(r=255),new y.Color(t,n,e,r)},hex:function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new y.Color(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},hsl:function(t,n,e,r){var i,s,o,a,u,h;return null==r&&(r=1),h=s=i=0,0===n?h=s=i=e:(o=function(t,n,e){return 0>e?e+=1:e>1&&(e-=1),1/6>e?t+6*(n-t)*e:.5>e?n:2/3>e?t+6*(n-t)*(2/3-e):t},u=.5>e?e*(1+n):e+n-e*n,a=2*e-u,h=o(a,u,t+1/3),s=o(a,u,t),i=o(a,u,t-1/3)),new y.Color(255*h,255*s,255*i,255*r)},randomSurfaces:function(t,n,e){var r,i,s,o,a;for(null==n&&(n=.5),null==e&&(e=.4),o=t.surfaces,a=[],i=0,s=o.length;s>i;i++)r=o[i],a.push(r.fill=new y.Material(y.Colors.hsl(Math.random(),n,e)));return a},randomSurfaces2:function(t,n,e,r){var i,s,o,a,u,h;for(null==n&&(n=.03),null==e&&(e=.5),null==r&&(r=.4),i=Math.random(),u=t.surfaces,h=[],o=0,a=u.length;a>o;o++)s=u[o],i+=(Math.random()-.5)*n,0>i&&(i=1),i>1&&(i=0),h.push(s.fill=new y.Material(y.Colors.hsl(i,.5,.4)));return h},randomShape:function(t,n,e){return null==n&&(n=.5),null==e&&(e=.4),t.fill(new y.Material(y.Colors.hsl(Math.random(),n,e)))},black:function(){return this.hex("#000000")},white:function(){return this.hex("#FFFFFF")},gray:function(){return this.hex("#888888")}},y.C=function(t,n,e,r){return new y.Color(t,n,e,r)},y.Material=function(){function t(t,n){this.color=t,null==n&&(n={}),y.Util.defaults(this,n,this.defaults)}return t.prototype.defaults={color:y.Colors.gray(),metallic:!1,specularColor:y.Colors.white(),specularExponent:8,shader:null},t.prototype.render=function(t,n,e){var r,i,s;return i=null!=(s=this.shader)?s:n,r=i.shade(t,e,this),r.a=this.color.a,r},t}(),y.Light=function(t){function n(t,e){this.type=t,n.__super__.constructor.apply(this,arguments),y.Util.defaults(this,e,this.defaults),this.id="l"+y.Util.uniqueId()}return z(n,t),n.prototype.defaults={point:y.P(),color:y.Colors.white(),intensity:.01,normal:y.P(1,-1,-1).normalize(),enabled:!0},n.prototype.render=function(){return this.colorIntensity=this.color.copy().scale(this.intensity)},n}(y.Transformable),y.Lights={point:function(t){return new y.Light("point",t)},directional:function(t){return new y.Light("directional",t)},ambient:function(t){return new y.Light("ambient",t)}},y.ShaderUtils={applyDiffuse:function(t,n,e,r){var i;return i=e.dot(r),i>0?t.addChannels(n.colorIntensity.copy().scale(i)):void 0},applyDiffuseAndSpecular:function(t,n,e,r,i){var s,o,a,u;return s=e.dot(r),s>0?(t.addChannels(n.colorIntensity.copy().scale(s)),o=y.Points.Z,a=r.copy().multiply(2*s).subtract(e),u=Math.pow(1+a.dot(o),i.specularExponent),t.offset(u*n.intensity)):void 0},applyAmbient:function(t,n){return t.addChannels(n.colorIntensity)}},y.Shader=function(){function t(){}return t.prototype.shade=function(){},t}(),f=function(t){function n(){return g=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o,a;for(r=new y.Color,o=0,a=t.length;a>o;o++)switch(i=t[o],i.type){case"point":s=i.point.copy().subtract(n.barycenter).normalize(),y.ShaderUtils.applyDiffuseAndSpecular(r,i,s,n.normal,e);break;case"directional":y.ShaderUtils.applyDiffuseAndSpecular(r,i,i.normal,n.normal,e);break;case"ambient":y.ShaderUtils.applyAmbient(r,i)}return r.multiplyChannels(e.color).clamp(0,255),r},n}(y.Shader),e=function(t){function n(){return v=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o,a;for(r=new y.Color,o=0,a=t.length;a>o;o++)switch(i=t[o],i.type){case"point":s=i.point.copy().subtract(n.barycenter).normalize(),y.ShaderUtils.applyDiffuse(r,i,s,n.normal,e);break;case"directional":y.ShaderUtils.applyDiffuse(r,i,i.normal,n.normal,e);break;case"ambient":y.ShaderUtils.applyAmbient(r,i)}return r.multiplyChannels(e.color).clamp(0,255),r},n}(y.Shader),n=function(t){function n(){return x=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o;for(r=new y.Color,s=0,o=t.length;o>s;s++)switch(i=t[s],i.type){case"ambient":y.ShaderUtils.applyAmbient(r,i)}return r.multiplyChannels(e.color).clamp(0,255),r},n}(y.Shader),i=function(t){function n(){return _=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.shade=function(t,n,e){return e.color},n}(y.Shader),y.Shaders={phong:new f,diffuse:new e,ambient:new n,flat:new i},y.RenderContext=function(){function t(){this.render=b(this.render,this),this.layers={}}return t.prototype.render=function(){var t,n,e;this.reset(),e=this.layers;for(t in e)n=e[t],n.context.reset(),n.layer.render(n.context),n.context.cleanup();return this.cleanup(),this},t.prototype.animate=function(){return(new y.Animator).onRender(this.render)},t.prototype.layer=function(t,n){return this.layers[t]={layer:n,context:this},this},t.prototype.reset=function(){},t.prototype.cleanup=function(){},t}(),y.RenderLayerContext=function(){function t(){}return t.prototype.path=function(){},t.prototype.text=function(){},t.prototype.rect=function(){},t.prototype.reset=function(){},t.prototype.cleanup=function(){},t}(),y.Painter=function(){function t(){}return t.prototype.paint=function(){},t}(),p=function(t){function n(){return w=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.paint=function(t,n){var e,r;return n.path().style({fill:null==t.fill?"none":t.fill.hex(),stroke:null==t.stroke?"none":t.stroke.hex(),"fill-opacity":null==(null!=(e=t.fill)?e.a:void 0)?1:t.fill.a/255,"stroke-width":null!=(r=t.surface["stroke-width"])?r:1}).path(t.projected.points)},n}(y.Painter),d=function(t){function n(){return M=n.__super__.constructor.apply(this,arguments)}return z(n,t),n.prototype.paint=function(t,n){var e;return n.text().style({fill:null==t.fill?"none":t.fill.hex(),stroke:null==t.stroke?"none":t.stroke.hex(),"text-anchor":null!=(e=t.surface.anchor)?e:"middle"}).transform(t.transform.copy().multiply(t.projection)).text(t.surface.text)},n}(y.Painter),y.Painters={path:new p,text:new d},y.RenderModel=function(){function t(t,n,e){this.surface=t,this.transform=n,this.projection=e,this.points=this.surface.points,this.transformed=this._initRenderData(),this.projected=this._initRenderData(),this._update()}return t.prototype.update=function(t,n){return!this.surface.dirty&&y.Util.arraysEqual(t.m,this.transform.m)&&y.Util.arraysEqual(n.m,this.projection.m)?void 0:(this.transform=t,this.projection=n,this._update())},t.prototype._update=function(){return this._math(this.transformed,this.points,this.transform,!1),this._math(this.projected,this.transformed.points,this.projection,!0),this.surface.dirty=!1},t.prototype._initRenderData=function(){var t;return{points:function(){var n,e,r,i;for(r=this.points,i=[],n=0,e=r.length;e>n;n++)t=r[n],i.push(t.copy());return i}.call(this),barycenter:y.P(),normal:y.P(),v0:y.P(),v1:y.P()}},t.prototype._math=function(t,n,e,r){var i,s,o,a,u,h,l,c;for(null==r&&(r=!1),i=a=0,h=n.length;h>a;i=++a)s=n[i],o=t.points[i],o.set(s).transform(e),r&&o.divide(o.w);for(t.barycenter.set(y.Points.ZERO),c=t.points,u=0,l=c.length;l>u;u++)s=c[u],t.barycenter.add(s);return t.barycenter.divide(t.points.length),t.v0.set(t.points[1]).subtract(t.points[0]),t.v1.set(t.points[n.length-1]).subtract(t.points[0]),t.normal.set(t.v0).cross(t.v1).normalize()},t}(),y.LightRenderModel=function(){function t(t,n){var e;this.colorIntensity=t.color.copy().scale(t.intensity),this.type=t.type,this.intensity=t.intensity,this.point=t.point.copy().transform(n),e=y.Points.ZERO.copy().transform(n),this.normal=t.normal.copy().transform(n).subtract(e).normalize()}return t}(),y.RenderLayer=function(){function t(){this.render=b(this.render,this)}return t.prototype.render=function(){},t}(),y.FillLayer=function(t){function n(t,n,e){this.width=null!=t?t:500,this.height=null!=n?n:500,this.fill=null!=e?e:"#EEE",this.render=b(this.render,this)}return z(n,t),n.prototype.render=function(t){return t.rect().style({fill:this.fill}).size({width:this.width,height:this.height})},n}(y.RenderLayer),y.SceneLayer=function(t){function n(t){this.scene=t,this.render=b(this.render,this)}return z(n,t),n.prototype.render=function(t){var n,e,r,i,s;for(i=this.scene.render(),s=[],e=0,r=i.length;r>e;e++)n=i[e],s.push(n.surface.painter.paint(n,t));return s},n}(y.RenderLayer),y.DebugLayer=function(t){function n(t){this._renderEnd=b(this._renderEnd,this),this._renderStart=b(this._renderStart,this),this.render=b(this.render,this),this._msg="",this._fps=30,t.onBefore(this._renderStart),t.onAfter(this._renderEnd)}return z(n,t),n.prototype.render=function(t){return t.text().style({fill:"#000"}).transform(y.M().translate(10,20).scale(1,-1,1)).text(this._msg)},n.prototype._renderStart=function(){return this._renderStartTime=new Date},n.prototype._renderEnd=function(){var t;return t=1e3/(new Date-this._renderStartTime),0/0!==t&&(this._fps+=(t-this._fps)/20),this._msg="fps: "+this._fps.toFixed(1)},n}(y.RenderLayer),y.LayersScene=function(t,n,e,r){return null==e&&(e=400),null==r&&(r=400),t.layer("background",new y.FillLayer(e,r)).layer("scene",new y.SceneLayer(n)),t},P=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},m=function(t){return"M"+t.map(function(t){return""+t.x+" "+t.y}).join("L")},S=function(t,n){var e,r,i;r="";for(e in n)i=n[e],r+=""+e+":"+i+";";return t.setAttribute("style",r)},y.SvgPathPainter=function(){function t(){}return t.prototype.setElement=function(t){this.el=t},t.prototype.style=function(t){return S(this.el,t),this},t.prototype.path=function(t){return this.el.setAttribute("d",m(t)),this},t}(),y.SvgTextPainter=function(){function t(){}return t.prototype.setElement=function(t){this.el=t},t.prototype.style=function(t){return S(this.el,t),this},t.prototype.transform=function(t){var n;return n=y.Matrices.flipY().multiply(t).m,this.el.setAttribute("transform","matrix("+n[0]+" "+n[4]+" "+n[1]+" "+n[5]+" "+n[3]+" "+n[7]+")"),this},t.prototype.text=function(t){return this.el.textContent=t,this},t}(),y.SvgRectPainter=function(){function t(){}return t.prototype.setElement=function(t){this.el=t},t.prototype.style=function(t){return S(this.el,t),this},t.prototype.size=function(t){var n,e;return e=t.width,n=t.height,this.el.setAttribute("width",e),this.el.setAttribute("height",n),this},t}(),y.SvgLayerRenderContext=function(t){function n(t){this.group=t,this.pathPainter=new y.SvgPathPainter,this.textPainter=new y.SvgTextPainter,this.rectPainter=new y.SvgRectPainter,this._i=0}return z(n,t),n.prototype.path=function(){var t;return t=this._manifest("path"),this.pathPainter.setElement(t),this.pathPainter},n.prototype.text=function(){var t;return t=this._manifest("text"),t.setAttribute("font-family","Roboto"),this.textPainter.setElement(t),this.textPainter},n.prototype.rect=function(){var t;return t=this._manifest("rect"),this.rectPainter.setElement(t),this.rectPainter},n.prototype.reset=function(){return this._i=0},n.prototype.cleanup=function(){var t,n;for(t=this.group.childNodes,n=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),n.push(this._i++);return n},n.prototype._manifest=function(t){var n,e,r;return n=this.group.childNodes,this._i>=n.length?(r=P(t),this.group.appendChild(r),this._i++,r):(e=n[this._i],e.tagName===t?(this._i++,e):(r=P(t),this.group.replaceChild(r,e),this._i++,r))},n}(y.RenderLayerContext),y.SvgRenderContext=function(t){function n(t){this.svg=t,n.__super__.constructor.call(this),this.svg=y.Util.element(this.svg)}return z(n,t),n.prototype.layer=function(t,n){var e;return this.svg.appendChild(e=P("g")),this.layers[t]={layer:n,context:new y.SvgLayerRenderContext(e)},this},n}(y.RenderContext),y.SvgContext=function(t,n,e,r){var i;return i=new y.SvgRenderContext(t),y.LayersScene(i,n,e,r)},y.CanvasPathPainter=function(){function t(t){this.ctx=t}return t.prototype.style=function(t){var n,e;for(n in t)switch(e=t[n],n){case"fill":this.ctx.fillStyle=e;break;case"stroke":this.ctx.strokeStyle=e}return this},t.prototype.path=function(t){var n,e,r,i;for(this.ctx.beginPath(),n=r=0,i=t.length;i>r;n=++r)e=t[n],0===n?this.ctx.moveTo(e.x,e.y):this.ctx.lineTo(e.x,e.y);return this.ctx.closePath(),this.ctx.fill(),this},t}(),y.CanvasTextPainter=function(){function t(t){this.ctx=t}return t.prototype.style=function(t){var n,e;for(n in t)switch(e=t[n],n){case"fill":this.ctx.fillStyle=e;break;case"stroke":this.ctx.strokeStyle=e}return this.ctx.font="16px Roboto",this},t.prototype.text=function(t){return this.ctx.fillText(t,0,0),this.ctx.setTransform(1,0,0,1,0,0),this},t.prototype.transform=function(t){var n;return n=y.Matrices.flipY().multiply(t).m,this.ctx.setTransform(n[0],n[4],n[1],n[5],n[3],n[7]),this},t}(),y.CanvasRectPainter=function(){function t(t){this.ctx=t}return t.prototype.style=function(t){var n,e;for(n in t)switch(e=t[n],n){case"fill":this.ctx.fillStyle=e;break;case"stroke":this.ctx.strokeStyle=e}return this},t.prototype.size=function(t){var n,e;return e=t.width,n=t.height,this.ctx.fillRect(0,0,e,n),this},t}(),y.CanvasLayerRenderContext=function(t){function n(t){this.ctx=t,this.pathPainter=new y.CanvasPathPainter(this.ctx),this.textPainter=new y.CanvasTextPainter(this.ctx),this.rectPainter=new y.CanvasRectPainter(this.ctx)}return z(n,t),n.prototype.path=function(){return this.pathPainter},n.prototype.text=function(){return this.textPainter},n.prototype.rect=function(){return this.rectPainter},n}(y.RenderLayerContext),y.CanvasRenderContext=function(t){function n(t,e,r){this.el=t,this.width=e,this.height=r,n.__super__.constructor.call(this),this.el=y.Util.element(this.el),this.ctx=this.el.getContext("2d")}return z(n,t),n.prototype.layer=function(t,n){return this.layers[t]={layer:n,context:new y.CanvasLayerRenderContext(this.ctx)},this},n.prototype.reset=function(){return this.ctx.clearRect(0,0,this.width,this.height)},n}(y.RenderContext),y.CanvasContext=function(t,n,e,r){var i;return i=new y.CanvasRenderContext(t,e,r),y.LayersScene(i,n,e,r)},y.WindowEvents=function(){var t;return t=y.Events.dispatch("mouseMove","mouseDown","mouseUp"),window.addEventListener("mouseup",t.mouseUp,!0),window.addEventListener("mousedown",t.mouseDown,!0),window.addEventListener("mousemove",t.mouseMove,!0),{on:t.on}}(),y.MouseEvents=function(){function t(t,n){this.el=t,this._onMouseUp=b(this._onMouseUp,this),this._onMouseDown=b(this._onMouseDown,this),this._onMouseMove=b(this._onMouseMove,this),y.Util.defaults(this,n,this.defaults),this._uid=y.Util.uniqueId("mouser-"),this.dispatch=y.Events.dispatch("dragStart","drag","dragEnd","mouseMove","mouseDown","mouseUp"),this.on=this.dispatch.on,this._mouseDown=!1,this.attach()}return t.prototype.attach=function(){return this.el.addEventListener("mousedown",this._onMouseDown)},t.prototype.detach=function(){return this.el.removeEventListener("mousedown",this._onMouseDown)},t.prototype._onMouseMove=function(t){return this.dispatch.mouseMove(t),this._mouseDown?this.dispatch.drag(t):void 0},t.prototype._onMouseDown=function(t){return this._mouseDown=!0,y.WindowEvents.on("mouseUp."+this._uid,this._onMouseUp),y.WindowEvents.on("mouseMove."+this._uid,this._onMouseMove),this.dispatch.mouseDown(t),this.dispatch.dragStart(t)},t.prototype._onMouseUp=function(t){return this._mouseDown=!1,y.WindowEvents.on("mouseUp."+this._uid,null),y.WindowEvents.on("mouseMove."+this._uid,null),this.dispatch.mouseUp(t),this.dispatch.dragEnd(t)},t}(),y.InertialMouse=function(){function t(){this.reset()}return t.inertiaExtinction=.1,t.smoothingTimeout=300,t.inertiaMsecDelay=30,t.prototype.get=function(){var t;return t=1e3/y.InertialMouse.inertiaMsecDelay,[this.x*t,this.y*t]},t.prototype.reset=function(){return this.xy=[0,0],this},t.prototype.update=function(t){var n,e;return null!=this.lastUpdate?(n=(new Date).getTime()-this.lastUpdate.getTime(),t=t.map(function(t){return t/Math.max(n,1)}),e=Math.min(1,n/y.InertialMouse.smoothingTimeout),this.x=e*t[0]+(1-e)*this.x,this.y=e*t[1]+(1-e)*this.y):(this.x=t[0],this.y=t[1]),this.lastUpdate=new Date,this},t.prototype.damp=function(){return this.x*=1-y.InertialMouse.inertiaExtinction,this.y*=1-y.InertialMouse.inertiaExtinction,this},t}(),y.Drag=function(){function t(t,n){var e;this.el=t,this._stopInertia=b(this._stopInertia,this),this._startInertia=b(this._startInertia,this),this._onInertia=b(this._onInertia,this),this._onDrag=b(this._onDrag,this),this._onDragEnd=b(this._onDragEnd,this),this._onDragStart=b(this._onDragStart,this),y.Util.defaults(this,n,this.defaults),this._uid=y.Util.uniqueId("dragger-"),this._inertiaRunning=!1,this._dragState={dragging:!1,origin:null,last:null,inertia:new y.InertialMouse},this.dispatch=y.Events.dispatch("drag"),this.on=this.dispatch.on,e=new y.MouseEvents(this.el),e.on("dragStart."+this._uid,this._onDragStart),e.on("dragEnd."+this._uid,this._onDragEnd),e.on("drag."+this._uid,this._onDrag)}return t.prototype.defaults={inertia:!1},t.prototype._onDragStart=function(t){return this._stopInertia(),this._dragState.dragging=!0,this._dragState.origin=[t.pageX,t.pageY],this._dragState.last=[t.pageX,t.pageY]},t.prototype._onDragEnd=function(t){var n;return this._dragState.dragging=!1,this.inertia?(n={offset:[t.pageX-this._dragState.origin[0],t.pageY-this._dragState.origin[1]],offsetRelative:[t.pageX-this._dragState.last[0],t.pageY-this._dragState.last[1]]},this._dragState.inertia.update(n.offsetRelative),this._startInertia()):void 0},t.prototype._onDrag=function(t){var n;return n={offset:[t.pageX-this._dragState.origin[0],t.pageY-this._dragState.origin[1]],offsetRelative:[t.pageX-this._dragState.last[0],t.pageY-this._dragState.last[1]]},this.dispatch.drag(n),this.inertia&&this._dragState.inertia.update(n.offsetRelative),this._dragState.last=[t.pageX,t.pageY]},t.prototype._onInertia=function(){var t;if(this._inertiaRunning)return t=this._dragState.inertia.damp().get(),Math.abs(t[0])<1&&Math.abs(t[1])<1?(this._stopInertia(),void 0):(this.dispatch.drag({offset:[this._dragState.last[0]-this._dragState.origin[0],this._dragState.last[0]-this._dragState.origin[1]],offsetRelative:t}),this._dragState.last=[this._dragState.last[0]+t[0],this._dragState.last[1]+t[1]],this._startInertia())},t.prototype._startInertia=function(){return this._inertiaRunning=!0,setTimeout(this._onInertia,y.InertialMouse.inertiaMsecDelay)},t.prototype._stopInertia=function(){return this._dragState.inertia.reset(),this._inertiaRunning=!1},t}(),y.Surface=function(){function t(t,n){this.points=t,this.painter=null!=n?n:y.Painters.path,this.id="s"+y.Util.uniqueId()}return t.prototype.cullBackfaces=!0,t.prototype.fill=new y.Material(y.C.gray),t.prototype.stroke=null,t}(),y.Shape=function(t){function n(t,e){this.type=t,this.surfaces=e,n.__super__.constructor.call(this)}return z(n,t),n.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},n.prototype.fill=function(t){return this.eachSurface(function(n){return n.fill=t}),this},n.prototype.stroke=function(t){return this.eachSurface(function(n){return n.stroke=t}),this},n}(y.Transformable),y.Model=function(t){function n(){n.__super__.constructor.call(this),this.children=[],this.lights=[]}return z(n,t),n.prototype.add=function(){var t,n,e,r;for(n=1<=arguments.length?q.call(arguments,0):[],e=0,r=n.length;r>e;e++)t=n[e],t instanceof y.Shape||t instanceof y.Model?this.children.push(t):t instanceof y.Light&&this.lights.push(t);return this},n.prototype.append=function(){var t;return t=new y.Model,this.add(t),t},n.prototype.eachShape=function(t){var n,e,r,i,s;for(i=this.children,s=[],e=0,r=i.length;r>e;e++)n=i[e],n instanceof y.Shape&&t.call(this,n),n instanceof y.Model?s.push(n.eachShape(t)):s.push(void 0);return s},n.prototype.eachRenderable=function(t,n){return this._eachRenderable(t,n,[],this.m)},n.prototype._eachRenderable=function(t,n,e,r){var i,s,o,a,u,h,l,c,p;for(this.lights.length>0&&(e=e.slice()),l=this.lights,o=0,u=l.length;u>o;o++)s=l[o],s.enabled&&e.push(t.call(this,s,s.m.copy().multiply(r)));for(c=this.children,p=[],a=0,h=c.length;h>a;a++)i=c[a],i instanceof y.Shape&&n.call(this,i,e,i.m.copy().multiply(r)),i instanceof y.Model?p.push(i._eachRenderable(t,n,e,i.m.copy().multiply(r))):p.push(void 0);return p},n}(y.Transformable),y.Models={"default":function(){var t;return t=new y.Model,t.add(y.Lights.directional({normal:y.P(-1,1,1).normalize(),color:y.Colors.hsl(.1,.3,.7),intensity:.004})),t.add(y.Lights.directional({normal:y.P(1,1,-1).normalize(),intensity:.003})),t.add(y.Lights.ambient({intensity:.0015})),t}},r=Math.sqrt(3)/2,a=.5257311121191336,u=.8506508083520399,o=[y.P(-a,0,-u),y.P(a,0,-u),y.P(-a,0,u),y.P(a,0,u),y.P(0,u,-a),y.P(0,u,a),y.P(0,-u,-a),y.P(0,-u,a),y.P(u,a,0),y.P(-u,a,0),y.P(u,-a,0),y.P(-u,-a,0)],s=[[0,4,1],[0,9,4],[9,5,4],[4,5,8],[4,8,1],[8,10,1],[8,3,10],[5,3,8],[5,2,3],[2,7,3],[7,10,3],[7,6,10],[7,11,6],[11,0,6],[0,1,6],[6,1,10],[9,0,11],[9,11,2],[9,2,5],[7,2,11]],y.Shapes={_cubeCoordinateMap:[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],_mapPointsToSurfaces:function(t,n){var e,r,i,s,o,a;for(s=[],o=0,a=n.length;a>o;o++)r=n[o],i=function(){var n,i,s;for(s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(t[e].copy());return s}(),s.push(new y.Surface(i));return s},_subdivideTriangles:function(t){var n,e,r,i,s,o,a;for(n=[],o=0,a=t.length;a>o;o++)e=t[o],r=e[0].copy().add(e[1]).normalize(),i=e[1].copy().add(e[2]).normalize(),s=e[2].copy().add(e[0]).normalize(),n.push([e[0],r,s]),n.push([e[1],i,r]),n.push([e[2],s,i]),n.push([r,i,s]);return n},cube:function(){var t;return t=[y.P(-1,-1,-1),y.P(-1,-1,1),y.P(-1,1,-1),y.P(-1,1,1),y.P(1,-1,-1),y.P(1,-1,1),y.P(1,1,-1),y.P(1,1,1)],new y.Shape("cube",y.Shapes._mapPointsToSurfaces(t,y.Shapes._cubeCoordinateMap))},unitcube:function(){var t;return t=[y.P(0,0,0),y.P(0,0,1),y.P(0,1,0),y.P(0,1,1),y.P(1,0,0),y.P(1,0,1),y.P(1,1,0),y.P(1,1,1)],new y.Shape("unitcube",y.Shapes._mapPointsToSurfaces(t,y.Shapes._cubeCoordinateMap))},rectangle:function(t,n){var e,r;return e=function(e,r,i){return y.P(e(t.x,n.x),r(t.y,n.y),i(t.z,n.z))},r=[e(Math.min,Math.min,Math.min),e(Math.min,Math.min,Math.max),e(Math.min,Math.max,Math.min),e(Math.min,Math.max,Math.max),e(Math.max,Math.min,Math.min),e(Math.max,Math.min,Math.max),e(Math.max,Math.max,Math.min),e(Math.max,Math.max,Math.max)],new y.Shape("rect",y.Shapes._mapPointsToSurfaces(r,y.Shapes._cubeCoordinateMap))},tetrahedron:function(){var t,n;return n=[y.P(1,1,1),y.P(-1,-1,1),y.P(-1,1,-1),y.P(1,-1,-1)],t=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],new y.Shape("tetrahedron",y.Shapes._mapPointsToSurfaces(n,t))},patch:function(t,n){var e,i,s,o,a,u,h,l,c,p,f,d,m,g,v,x,_,w;for(null==t&&(t=20),null==n&&(n=20),t=Math.round(t),n=Math.round(n),u=[],h=c=0;t>=0?t>c:c>t;h=t>=0?++c:--c){for(e=[],l=p=0;n>=0?n>p:p>n;l=n>=0?++p:--p)for(o=[y.P(h,l),y.P(h+1,l-.5),y.P(h+1,l+.5)],a=[y.P(h,l),y.P(h+1,l+.5),y.P(h,l+1)],_=[o,a],f=0,m=_.length;m>f;f++){for(s=_[f],d=0,g=s.length;g>d;d++)i=s[d],i.x*=r,i.y+=0===h%2?.5:0;e.push(s)}if(0!==h%2){for(w=e[0],x=0,v=w.length;v>x;x++)i=w[x],i.y+=n;e.push(e.shift())}u=u.concat(e)}return new y.Shape("patch",u.map(function(t){return new y.Surface(t)}))},icosahedron:function(){return new y.Shape("icosahedron",y.Shapes._mapPointsToSurfaces(o,s))},sphere:function(t){var n,e,r;for(null==t&&(t=1),e=s.map(function(t){return t.map(function(t){return o[t]})}),n=r=0;t>=0?t>r:r>t;n=t>=0?++r:--r)e=y.Shapes._subdivideTriangles(e);return new y.Shape("sphere",e.map(function(t){return new y.Surface(t.map(function(t){return t.copy()}))}))},text:function(t){var n;return n=new y.Surface([y.P(0,0,0),y.P(20,0,0),y.P(0,20,0)],y.Painters.text),n.text=t,new y.Shape("text",[n])},extrude:function(t,n){var e,r,i,s,o,a,u,h;for(null==n&&(n=1),a=[],r=new y.Surface(function(){var n,e,r;for(r=[],n=0,e=t.length;e>n;n++)o=t[n],r.push(o.copy());return r}()),e=new y.Surface(function(){var e,r,i;for(i=[],e=0,r=t.length;r>e;e++)o=t[e],i.push(o.translate(0,0,n));return i}()),i=u=1,h=t.length;h>=1?h>u:u>h;i=h>=1?++u:--u)a.push(new y.Surface([r.points[i-1].copy(),e.points[i-1].copy(),e.points[i].copy(),r.points[i].copy()]));return s=t.length,a.push(new y.Surface([r.points[s-1].copy(),e.points[s-1].copy(),e.points[0].copy(),r.points[0].copy()])),e.points.reverse(),a.push(r),a.push(e),new y.Shape("extrusion",a)},arrow:function(t,n,e,r,i){var s,o;return null==t&&(t=1),null==n&&(n=1),null==e&&(e=1),null==r&&(r=1),null==i&&(i=0),s=e/2,o=[y.P(0,0,0),y.P(r+i,1,0),y.P(r,s,0),y.P(r+n,s,0),y.P(r+n,-s,0),y.P(r,-s,0),y.P(r+i,-1,0)],y.Shapes.extrude(o,t)},path:function(t){return new y.Shape("path",[new y.Surface(t)])},custom:function(t){var n,e,r,i,s,o;for(r=[],o=t.surfaces,i=0,s=o.length;s>i;i++)n=o[i],r.push(new y.Surface(function(){var t,r,i;for(i=[],t=0,r=n.length;r>t;t++)e=n[t],i.push(y.P.apply(y,e));return i}()));return new y.Shape("custom",r)}},y.ObjParser=function(){function t(){var t=this;this.vertices=[],this.faces=[],this.commands={v:function(n){return t.vertices.push(n.map(function(t){return parseFloat(t)
}))},f:function(n){return t.faces.push(n.map(function(t){return parseInt(t)}))}}}return t.prototype.parse=function(t){var n,e,r,i,s,o,a;for(o=t.split(/[\r\n]+/),a=[],i=0,s=o.length;s>i;i++)r=o[i],e=r.trim().split(/[ ]+/),e.length<2||(n=e.slice(0,1)[0],e=e.slice(1),"#"!==n.charAt(0)&&(null!=this.commands[n]?a.push(this.commands[n](e)):console.log("OBJ Parser: Skipping unknown command '"+n+"'")));return a},t.prototype.mapFacePoints=function(t){var n=this;return this.faces.map(function(e){var r;return r=e.map(function(t){return y.P.apply(y,n.vertices[t-1])}),t.call(n,r)})},t}(),y.Shapes.obj=function(t,n){var e;return null==n&&(n=!0),e=new y.ObjParser,e.parse(t),new y.Shape("obj",e.mapFacePoints(function(t){var e;return e=new y.Surface(t),e.cullBackfaces=n,e}))},y.Animator=function(){function t(){this.render=b(this.render,this),this.dispatch=y.Events.dispatch("beforeRender","afterRender","render"),this.on=this.dispatch.on}return t.prototype.startRenderLoop=function(t){return null==t&&(t=30),setInterval(this.render,t),this},t.prototype.render=function(){return this.dispatch.beforeRender(),this.dispatch.render(),this.dispatch.afterRender(),this},t.prototype.onBefore=function(t){return this.on("beforeRender."+y.Util.uniqueId("animator-"),t),this},t.prototype.onAfter=function(t){return this.on("afterRender."+y.Util.uniqueId("animator-"),t),this},t.prototype.onRender=function(t){return this.on("render."+y.Util.uniqueId("animator-"),t),this},t}(),y.Projections={perspectiveFov:function(t,n){var e;return null==t&&(t=50),null==n&&(n=1),e=n*Math.tan(t*Math.PI/360),y.Projections.perspective(-e,e,-e,e,n,2*n)},perspective:function(t,n,e,r,i,s){var o,a,u,h,l;return null==t&&(t=-1),null==n&&(n=1),null==e&&(e=-1),null==r&&(r=1),null==i&&(i=1),null==s&&(s=100),l=2*i,o=n-t,a=r-e,u=s-i,h=new Array(16),h[0]=l/o,h[1]=0,h[2]=(n+t)/o,h[3]=0,h[4]=0,h[5]=l/a,h[6]=(r+e)/a,h[7]=0,h[8]=0,h[9]=0,h[10]=-(s+i)/u,h[11]=-(s*l)/u,h[12]=0,h[13]=0,h[14]=-1,h[15]=0,y.M(h)},ortho:function(t,n,e,r,i,s){var o,a,u,h,l;return null==t&&(t=-1),null==n&&(n=1),null==e&&(e=-1),null==r&&(r=1),null==i&&(i=1),null==s&&(s=100),l=2*i,o=n-t,a=r-e,u=s-i,h=new Array(16),h[0]=2/o,h[1]=0,h[2]=0,h[3]=(n+t)/o,h[4]=0,h[5]=2/a,h[6]=0,h[7]=-(r+e)/a,h[8]=0,h[9]=0,h[10]=-2/u,h[11]=-(s+i)/u,h[12]=0,h[13]=0,h[14]=0,h[15]=1,y.M(h)}},y.Viewports={center:function(t,n,e,r){var i,s;return null==t&&(t=500),null==n&&(n=500),null==e&&(e=0),null==r&&(r=0),s=y.M().translate(-e,-r,-1).scale(1/t,1/n,1/n),i=y.M().scale(t,-n,n).translate(e+t/2,r+n/2),{prescale:s,postscale:i}},origin:function(t,n,e,r){var i,s;return null==t&&(t=500),null==n&&(n=500),null==e&&(e=0),null==r&&(r=0),s=y.M().translate(-e,-r,-1).scale(1/t,1/n,1/n),i=y.M().scale(t,-n,n).translate(e,r),{prescale:s,postscale:i}}},y.Camera=function(){function t(t){y.Util.defaults(this,t,this.defaults)}return t.prototype.defaults={projection:y.Projections.perspective(),viewport:y.Viewports.center(),camera:y.Matrices.identity()},t.prototype.getMatrix=function(){return this.camera.copy().multiply(this.viewport.prescale).multiply(this.projection).multiply(this.viewport.postscale)},t}(),y.Scene=function(){function t(t){this.render=b(this.render,this),y.Util.defaults(this,t,this.defaults),this._renderModelCache={}}return t.prototype.defaults={model:new y.Model,camera:new y.Camera,shader:y.Shaders.phong,cullBackfaces:!0,fractionalPoints:!1},t.prototype.render=function(){var t,n,e=this;return t=this.camera.getMatrix(),n=[],this.model.eachRenderable(function(t,n){return new y.LightRenderModel(t,n)},function(r,i,s){var o,a,u,h,l,c,p,f,d,y,m,g;for(f=r.surfaces,g=[],h=0,c=f.length;c>h;h++)if(u=f[h],a=e._renderSurface(u,s,t),!e.cullBackfaces||!u.cullBackfaces||a.projected.normal.z<0){if(a.fill=null!=(d=u.fill)?d.render(i,e.shader,a.transformed):void 0,a.stroke=null!=(y=u.stroke)?y.render(i,e.shader,a.transformed):void 0,e.fractionalPoints!==!0)for(m=a.projected.points,l=0,p=m.length;p>l;l++)o=m[l],o.round();g.push(n.push(a))}else g.push(void 0);return g}),n.sort(function(t,n){return n.projected.barycenter.z-t.projected.barycenter.z}),n},t.prototype._renderSurface=function(t,n,e){var r;return r=this._renderModelCache[t.id],null==r?r=this._renderModelCache[t.id]=new y.RenderModel(t,n,e):r.update(n,e),r},t}()}).call(this);