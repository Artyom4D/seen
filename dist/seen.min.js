!function(){var t,n,r,e,i,o,s,u,h,a,p,l,f,y,d,m,_,x,v,g=function(t,n){return function(){return t.apply(n,arguments)}},w={}.hasOwnProperty,b=function(t,n){function r(){this.constructor=t}for(var e in n)w.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};p=("undefined"!=typeof exports&&null!==exports?exports:this).seen={},o=1,p.Util={defaults:function(t,n,r){var e,i;for(e in n)null==t[e]&&(t[e]=n[e]);i=[];for(e in r)null==t[e]?i.push(t[e]=r[e]):i.push(void 0);return i},arraysEqual:function(t,n){var r,e,i,o;if(!t.length===n.length)return!1;for(r=i=0,o=t.length;o>i;r=++i)if(e=t[r],e!==n[r])return!1;return!0},uniqueId:function(){return o++}},t=new Array(16),i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p.Matrix=function(){function n(t){return this.m=null!=t?t:null,null==this.m&&(this.m=i.slice()),this}return n.prototype.copy=function(){return new p.Matrix(this.m.slice())},n.prototype.reset=function(){return this.m=i.slice(),this},n.prototype.multiply=function(t){return this.copy()._multiply(t)},n.prototype.multiplyM=function(t){return this.copy()._multiplyM(t)},n.prototype.rotx=function(t){return this.copy()._rotx(t)},n.prototype.roty=function(t){return this.copy()._roty(t)},n.prototype.rotz=function(t){return this.copy()._rotz(t)},n.prototype.translate=function(t,n,r){return this.copy()._translate(t,n,r)},n.prototype.scale=function(t,n){return this.copy()._scale(t,n,t)},n.prototype._multiply=function(t){return this._multiplyM(t.m)},n.prototype._multiplyM=function(n){var r,e,i,o,s;for(r=t,i=o=0;4>o;i=++o)for(e=s=0;16>s;e=s+=4)r[e+i]=n[e]*this.m[i]+n[e+1]*this.m[4+i]+n[e+2]*this.m[8+i]+n[e+3]*this.m[12+i];return t=this.m,this.m=r,this},n.prototype._rotx=function(t){var n,r,e;return n=Math.cos(t),e=Math.sin(t),r=[1,0,0,0,0,n,-e,0,0,e,n,0,0,0,0,1],this._multiplyM(r)},n.prototype._roty=function(t){var n,r,e;return n=Math.cos(t),e=Math.sin(t),r=[n,0,e,0,0,1,0,0,-e,0,n,0,0,0,0,1],this._multiplyM(r)},n.prototype._rotz=function(t){var n,r,e;return n=Math.cos(t),e=Math.sin(t),r=[n,-e,0,0,e,n,0,0,0,0,1,0,0,0,0,1],this._multiplyM(r)},n.prototype._translate=function(t,n,r){return null==t&&(t=0),null==n&&(n=0),null==r&&(r=0),this.m[3]+=t,this.m[7]+=n,this.m[11]+=r,this},n.prototype._scale=function(t,n,r){return null==t&&(t=1),null==n&&(n=t),null==r&&(r=n),this.m[0]*=t,this.m[5]*=n,this.m[10]*=r,this},n}(),p.M=function(t){return new p.Matrix(t)},p.Matrices={identity:p.M(),flipX:p.M().scale(-1,1,1),flipY:p.M().scale(1,-1,1),flipZ:p.M().scale(1,1,-1)},p.Transformable=function(){function t(){this.m=new p.Matrix}return t.prototype.scale=function(t,n,r){return this.m._scale(t,n,r),this},t.prototype.translate=function(t,n,r){return this.m._translate(t,n,r),this},t.prototype.rotx=function(t){return this.m._rotx(t),this},t.prototype.roty=function(t){return this.m._roty(t),this},t.prototype.rotz=function(t){return this.m._rotz(t),this},t.prototype.matrix=function(t){return this.m._multiplyM(t),this},t.prototype.transform=function(t){return this.m._multiply(t),this},t.prototype.reset=function(){return this.m.reset(),this},t}(),p.Point=function(){function t(t,n,r,e){this.x=null!=t?t:0,this.y=null!=n?n:0,this.z=null!=r?r:0,this.w=null!=e?e:1}return t.prototype.transform=function(t){var n;return n=s,n.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],n.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],n.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],n.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(n),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copy=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.normalize=function(){return this.copy()._normalize()},t.prototype.add=function(t){return this.copy()._add(t)},t.prototype.subtract=function(t){return this.copy()._subtract(t)},t.prototype.cross=function(t){return this.copy()._cross(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.multiply=function(t){return this.copy()._multiply(t)},t.prototype.divide=function(t){return this.copy()._divide(t)},t.prototype._multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype._divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype._normalize=function(){var t;return t=Math.sqrt(this.dot(this)),0===t?this.set(Points.Z):this._divide(t),this},t.prototype._add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype._subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype._cross=function(t){var n;return n=s,n.x=this.y*t.z-this.z*t.y,n.y=this.z*t.x-this.x*t.z,n.z=this.x*t.y-this.y*t.x,this.set(n),this},t.prototype.toJSON=function(){return[this.x,this.y,this.z,this.w]},t}(),p.P=function(t,n,r,e){return new p.Point(t,n,r,e)},s=p.P(),p.Points={X:p.P(1,0,0),Y:p.P(0,1,0),Z:p.P(0,0,1),ZERO:p.P(0,0,0)},p.Color=function(){function t(t,n,r,e){this.r=null!=t?t:0,this.g=null!=n?n:0,this.b=null!=r?r:0,this.a=null!=e?e:255}return t.prototype.copy=function(){return new p.Color(this.r,this.g,this.b,this.a)},t.prototype.scale=function(t){return this.copy()._scale(t)},t.prototype.offset=function(){return this.copy()._offset(c)},t.prototype.clamp=function(t,n){return this.copy()._clamp(t,n)},t.prototype.addChannels=function(t){return this.copy()._addChannels(t)},t.prototype.multiplyChannels=function(t){return this.copy()._multiplyChannels(t)},t.prototype._scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this},t.prototype._offset=function(t){return this.r+=t,this.g+=t,this.b+=t,this},t.prototype._clamp=function(t,n){return null==t&&(t=0),null==n&&(n=255),this.r=Math.min(n,Math.max(t,this.r)),this.g=Math.min(n,Math.max(t,this.g)),this.b=Math.min(n,Math.max(t,this.b)),this},t.prototype._addChannels=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},t.prototype._multiplyChannels=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},t.prototype.hex=function(){var t;for(t=(this.r<<16|this.g<<8|this.b).toString(16);t.length<6;)t="0"+t;return"#"+t},t.prototype.style=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t}(),p.Colors={rgb:function(t,n,r,e){return new p.Color(t,n,r,e)},hex:function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new p.Color(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},hsl:function(t,n,r){var e,i,o,s,u,h;return h=i=e=0,0===n?h=i=e=r:(o=function(t,n,r){return 0>r?r+=1:r>1&&(r-=1),1/6>r?t+6*(n-t)*r:.5>r?n:2/3>r?t+6*(n-t)*(2/3-r):t},u=.5>r?r*(1+n):r+n-r*n,s=2*r-u,h=o(s,u,t+1/3),i=o(s,u,t),e=o(s,u,t-1/3)),new p.Color(255*h,255*i,255*e)}},p.C=p.Colors,p.C.black=p.C.hex("#000000"),p.C.white=p.C.hex("#FFFFFF"),p.C.gray=p.C.hex("#888888"),p.Material=function(){function t(t){this.color=t,p.Util.defaults(this,{},this.defaults)}return t.prototype.defaults={color:p.C.gray,metallic:!1,specularColor:p.C.white,specularExponent:8,shader:null},t.prototype.render=function(t,n,r){var e,i;return e=null!=(i=this.shader)?i:n,e.shade(t,r,this)},t}(),p.Light=function(t){function n(t){this.transform=g(this.transform,this),p.Util.defaults(this,t,{point:p.P(),color:p.C.white,intensity:.01})}return b(n,t),n.prototype.render=function(){return this.colorIntensity=this.color.scale(this.intensity)},n.prototype.transform=function(t){return this.point.transform(t)},n}(p.Transformable),p.Shader=function(){function t(){}return t.prototype.shade=function(){},t}(),h=function(t){function n(){return f=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.shade=function(t,n,r){var e,i,o,s,u,h,a,c,l,f,y,d;for(o=new p.Color,y=t.points,a=0,l=y.length;l>a;a++)u=y[a],e=u.point.subtract(n.barycenter).normalize(),s=e.dot(n.normal),s>0&&(o._addChannels(u.colorIntensity.scale(s)),i=n.normal.multiply(2*s).subtract(e),h=Math.pow(1+i.dot(p.Points.Z),r.specularExponent),o._offset(h*u.intensity));for(d=t.ambients,c=0,f=d.length;f>c;c++)u=d[c],o._addChannels(u.colorIntensity);return o._multiplyChannels(r.color)._clamp(0,255),o},n}(p.Shader),r=function(t){function n(){return y=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.shade=function(t,n,r){var e,i,o,s,u,h,a,c,l,f;for(i=new p.Color,l=t.points,u=0,a=l.length;a>u;u++)s=l[u],e=s.point.subtract(n.barycenter).normalize(),o=e.dot(n.normal),o>0&&i._addChannels(s.colorIntensity.scale(o));for(f=t.ambients,h=0,c=f.length;c>h;h++)s=f[h],i._addChannels(s.colorIntensity);return i._multiplyChannels(r.color)._clamp(0,255),i},n}(p.Shader),n=function(t){function n(){return d=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.shade=function(t,n,r){var e,i,o,s,u;for(e=new p.Color,u=t.ambients,o=0,s=u.length;s>o;o++)i=u[o],e._addChannels(i.colorIntensity);return e._multiplyChannels(r.color)._clamp(0,255),e},n}(p.Shader),e=function(t){function n(){return m=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.shade=function(t,n,r){return r.color},n}(p.Shader),p.Shaders={phong:new h,diffuse:new r,ambient:new n,flat:new e},p.RenderSurface=function(){function t(t,n,r){this.points=t,this.transform=n,this.projection=r,this.transformed=this._initRenderData(),this.projected=this._initRenderData(),this._update()}return t.prototype.update=function(t,n){return p.Util.arraysEqual(t.m,this.transform.m)&&p.Util.arraysEqual(n.m,this.projection.m)?void 0:(this.transform=t,this.projection=n,this._update())},t.prototype._update=function(){return this._math(this.transformed,this.points,this.transform,!1),this._math(this.projected,this.transformed.points,this.projection,!0)},t.prototype._initRenderData=function(){var t;return{points:function(){var n,r,e,i;for(e=this.points,i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(t.copy());return i}.call(this),barycenter:p.P(),normal:p.P(),v0:p.P(),v1:p.P()}},t.prototype._math=function(t,n,r,e){var i,o,s,u,h,a,c,l;for(null==e&&(e=!1),i=u=0,a=n.length;a>u;i=++u)o=n[i],s=t.points[i],s.set(o).transform(r),e&&s._divide(s.w);for(t.barycenter.set(p.Points.ZERO),l=t.points,h=0,c=l.length;c>h;h++)o=l[h],t.barycenter._add(o);return t.barycenter._divide(t.points.length),t.v0.set(t.points[1])._subtract(t.points[0]),t.v1.set(t.points[n.length-1])._subtract(t.points[0]),t.normal.set(t.v0._cross(t.v1)._normalize())},t}(),p.Surface=function(){function t(t,n){this.points=t,this.painter=null!=n?n:p.Painters.path,this.id="s"+p.Util.uniqueId()}return t.prototype.cullBackfaces=!0,t.prototype.fill=new p.Material(p.C.gray),t.prototype.stroke=null,t}(),p.Shape=function(t){function n(t,r){this.type=t,this.surfaces=r,n.__super__.constructor.call(this)}return b(n,t),n.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},n.prototype.fill=function(t){return this.eachSurface(function(n){return n.fill=t}),this},n.prototype.stroke=function(t){return this.eachSurface(function(n){return n.stroke=t}),this},n}(p.Transformable),p.Group=function(t){function n(){n.__super__.constructor.call(this),this.children=[]}return b(n,t),n.prototype.add=function(t){return this.children.push(t),this},n.prototype.append=function(){var t;return t=new p.Group,this.add(t),t},n.prototype.eachShape=function(t){var n,r,e,i,o;for(i=this.children,o=[],r=0,e=i.length;e>r;r++)n=i[r],n instanceof p.Shape&&t.call(this,n),n instanceof p.Group?o.push(n.eachTransformedShape(t)):o.push(void 0);return o},n.prototype.eachTransformedShape=function(t,n){var r,e,i,o,s;for(null==n&&(n=null),null==n&&(n=this.m),o=this.children,s=[],e=0,i=o.length;i>e;e++)r=o[e],r instanceof p.Shape&&t.call(this,r,r.m.multiply(n)),r instanceof p.Group?s.push(r.eachTransformedShape(t,r.m.multiply(n))):s.push(void 0);return s},n}(p.Transformable),p.Painter=function(){function t(){}return t.prototype.paint=function(){},t}(),u=function(t){function n(){return _=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.paint=function(t,n){var r,e;return r=t.render,n.path().path(r.projected.points).style({fill:null==r.fill?"none":r.fill.hex(),stroke:null==r.stroke?"none":r.stroke.hex(),"fill-opacity":null==t.fill?1:t.fill.a/255,"stroke-width":null!=(e=t["stroke-width"])?e:1})},n}(p.Painter),a=function(t){function n(){return x=n.__super__.constructor.apply(this,arguments)}return b(n,t),n.prototype.paint=function(t,n){var r,e;return r=t.render,n.text().text(t.text).transform(r.transform.multiply(r.projection)).style({fill:null==r.fill?"none":r.fill.hex(),stroke:null==r.stroke?"none":r.stroke.hex(),"text-anchor":null!=(e=t.anchor)?e:"middle"})},n}(p.Painter),p.Painters={path:new u,text:new a},p.Shapes={_cubeCoordinateMap:[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],_mapPointsToSurfaces:function(t,n){var r,e,i,o,s,u;for(o=[],s=0,u=n.length;u>s;s++)e=n[s],i=function(){var n,i,o;for(o=[],n=0,i=e.length;i>n;n++)r=e[n],o.push(t[r].copy());return o}(),o.push(new p.Surface(i));return o},cube:function(){var t;return t=[p.P(-1,-1,-1),p.P(-1,-1,1),p.P(-1,1,-1),p.P(-1,1,1),p.P(1,-1,-1),p.P(1,-1,1),p.P(1,1,-1),p.P(1,1,1)],new p.Shape("cube",p.Shapes._mapPointsToSurfaces(t,p.Shapes._cubeCoordinateMap))},unitcube:function(){var t;return t=[p.P(0,0,0),p.P(0,0,1),p.P(0,1,0),p.P(0,1,1),p.P(1,0,0),p.P(1,0,1),p.P(1,1,0),p.P(1,1,1)],new p.Shape("unitcube",p.Shapes._mapPointsToSurfaces(t,p.Shapes._cubeCoordinateMap))},rectangle:function(t,n){var r,e;return r=function(r,e,i){return p.P(r(t.x,n.x),e(t.y,n.y),i(t.z,n.z))},e=[r(Math.min,Math.min,Math.min),r(Math.min,Math.min,Math.max),r(Math.min,Math.max,Math.min),r(Math.min,Math.max,Math.max),r(Math.max,Math.min,Math.min),r(Math.max,Math.min,Math.max),r(Math.max,Math.max,Math.min),r(Math.max,Math.max,Math.max)],new p.Shape("rect",p.Shapes._mapPointsToSurfaces(e,p.Shapes._cubeCoordinateMap))},tetrahedron:function(){var t,n;return n=[p.P(1,1,1),p.P(-1,-1,1),p.P(-1,1,-1),p.P(1,-1,-1)],t=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],new p.Shape("tetrahedron",p.Shapes._mapPointsToSurfaces(n,t))},text:function(t){var n;return n=new p.Surface([p.P(0,0,-1),p.P(0,20,-1),p.P(20,0,-1)],p.Painters.text),n.text=t,n.cullBackfaces=!1,new p.Shape("text",[n])},extrude:function(t,n){var r,e,i,o,s,u,h,a;for(null==n&&(n=1),u=[],e=new p.Surface(function(){var n,r,e;for(e=[],n=0,r=t.length;r>n;n++)s=t[n],e.push(s.copy());return e}()),r=new p.Surface(function(){var r,e,i;for(i=[],r=0,e=t.length;e>r;r++)s=t[r],i.push(s.translate(0,0,n));return i}()),i=h=1,a=t.length;a>=1?a>h:h>a;i=a>=1?++h:--h)u.push(new p.Surface([e.points[i-1].copy(),r.points[i-1].copy(),r.points[i].copy(),e.points[i].copy()]));return o=t.length,u.push(new p.Surface([e.points[o-1].copy(),r.points[o-1].copy(),r.points[0].copy(),e.points[0].copy()])),r.points.reverse(),u.push(e),u.push(r),new p.Shape("extrusion",u)},arrow:function(t,n,r,e,i){var o,s;return null==t&&(t=1),null==n&&(n=1),null==r&&(r=1),null==e&&(e=1),null==i&&(i=0),o=r/2,s=[p.P(0,0,0),p.P(e+i,1,0),p.P(e,o,0),p.P(e+n,o,0),p.P(e+n,-o,0),p.P(e,-o,0),p.P(e+i,-1,0)],p.Shapes.extrude(s,t)},path:function(t){return new p.Shape("path",[new p.Surface(t)])},custom:function(t){var n,r,e,i,o,s;for(e=[],s=t.surfaces,i=0,o=s.length;o>i;i++)n=s[i],e.push(new p.Surface(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(p.P.apply(p,r));return i}()));return new p.Shape("custom",e)}},p.Projections={perspectiveFov:function(t,n){var r;return null==t&&(t=50),null==n&&(n=100),r=n*Math.tan(t*Math.PI/360),p.Projections.perspective(-r,r,-r,r,n,2*n)},orthoExtent:function(t){return null==t&&(t=100),p.Projections.ortho(-t,t,-t,t,t,2*t)},perspective:function(t,n,r,e,i,o){var s,u,h,a,c;return c=2*i,s=n-t,u=e-r,h=o-i,a=new Array(16),a[0]=c/s,a[1]=0,a[2]=(n+t)/s,a[3]=0,a[4]=0,a[5]=c/u,a[6]=(e+r)/u,a[7]=0,a[8]=0,a[9]=0,a[10]=-(o+i)/h,a[11]=-(o*c)/h,a[12]=0,a[13]=0,a[14]=-1,a[15]=0,new p.Matrix(a)},ortho:function(t,n,r,e,i,o){var s,u,h,a,c;return c=2*i,s=n-t,u=e-r,h=o-i,a=new Array(16),a[0]=2/s,a[1]=0,a[2]=0,a[3]=(n+t)/s,a[4]=0,a[5]=2/u,a[6]=0,a[7]=-(e+r)/u,a[8]=0,a[9]=0,a[10]=-2/h,a[11]=-(o+i)/h,a[12]=0,a[13]=0,a[14]=0,a[15]=1,new p.Matrix(a)}},p.Viewports={centerOrigin:function(t,n,r,e){return null==t&&(t=500),null==n&&(n=500),null==r&&(r=0),null==e&&(e=0),(new p.Matrix).scale(t/2,-n/2).translate(r+t/2,e+n/2)}},v=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},l=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),p.Renderer=function(){function t(){}return t.prototype.render=function(t){var n,r,e;for(this.reset(),r=0,e=t.length;e>r;r++)n=t[r],n.painter.paint(n,this);return this.hideUnused()},t.prototype.path=function(){},t.prototype.text=function(){},t}(),p.SvgRenderer=function(t){function n(){this._i=0}return b(n,t),n.prototype.addTo=function(t){return this._g=t},n.prototype.path=function(){var t;return t=this._manifest("path"),{el:t,path:function(n){return t.setAttribute("d",l(n)),this},style:function(n){var r,e,i;e="";for(r in n)i=n[r],e+=""+r+":"+i+";";return t.setAttribute("style",e),this}}},n.prototype.text=function(){var t;return t=this._manifest("text"),t.setAttribute("font-family","Roboto"),{el:t,text:function(n){return t.textContent=n,this},style:function(n){var r,e,i;e="";for(r in n)i=n[r],e+=""+r+":"+i+";";return t.setAttribute("style",e),this},transform:function(n){var r;return r=n.m,t.setAttribute("transform","matrix("+r[0]+" "+r[4]+" "+r[1]+" "+r[5]+" "+r[3]+" "+r[7]+")"),this}}},n.prototype.reset=function(){return this._i=0},n.prototype.hideUnused=function(){var t,n;for(t=this._g.childNodes,n=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),n.push(this._i++);return n},n.prototype._manifest=function(t){var n,r,e;return n=this._g.childNodes,this._i>=n.length?(e=v(t),this._g.appendChild(e),this._i++,e):(r=n[this._i],r.tagName===t?(this._i++,r):(e=v(t),this._g.replaceChild(e,r),this._i++,e))},n}(p.Renderer),p.SvgCanvas=function(){function t(t){this.svg=t,this.layers={}}return t.prototype.layer=function(t,n){var r;return r=this.layers[t]=v("g"),this.svg.appendChild(r),null!=n&&n.addTo(r),this},t}(),p.SvgRenderDebug=function(){function t(t){this._renderEnd=g(this._renderEnd,this),this._renderStart=g(this._renderStart,this),this._text=v("text"),this._text.setAttribute("style","text-anchor:end;"),this._text.setAttribute("x",490),this._text.setAttribute("y","20"),this._fps=30,t.on("beforeRender.debug",this._renderStart),t.on("afterRender.debug",this._renderEnd)}return t.prototype.addTo=function(t){return t.appendChild(this._text)},t.prototype._renderStart=function(){return this._renderStartTime=new Date},t.prototype._renderEnd=function(t){var n;return n=1e3/(new Date-this._renderStartTime),0/0!==n&&(this._fps+=(n-this._fps)/20),this._text.textContent="fps: "+this._fps.toFixed(1)+" surfaces: "+t.surfaces.length},t}(),p.SvgFillRect=function(){function t(){}return t.prototype.addTo=function(t){var n;return n=v("rect"),n.setAttribute("fill","#EEE"),n.setAttribute("width",500),n.setAttribute("height",500),t.appendChild(n)},t}(),p.Scene=function(){function t(t){this._renderSurfaces=g(this._renderSurfaces,this),this.render=g(this.render,this),p.Util.defaults(this,t,this.defaults),this.dispatch=d3.dispatch("beforeRender","afterRender"),d3.rebind(this,this.dispatch,["on"]),this.group=new p.Group,this.shader=p.Shaders.phong,this.lights={points:[],ambients:[]},this.surfaces=[],this.renderModelCache={}}return t.prototype.defaults={cullBackfaces:!0,projection:p.Projections.perspective(-100,100,-100,100,100,300),viewport:p.Viewports.centerOrigin(500,500)},t.prototype.startRenderLoop=function(t){return null==t&&(t=30),setInterval(this.render,t)},t.prototype.render=function(){var t;return this.dispatch.beforeRender(),t=this._renderSurfaces(),this.renderer.render(t),this.dispatch.afterRender({surfaces:t}),this},t.prototype._renderSurfaces=function(){var t,n,r,e,i,o,s,u=this;e=this.projection.multiply(this.viewport),s=this.lights;for(t in s)for(r=s[t],i=0,o=r.length;o>i;i++)n=r[i],n.render();return this.surfaces.length=0,this.group.eachTransformedShape(function(t,n){var r,i,o,s,h,a,p,c;for(h=t.surfaces,c=[],o=0,s=h.length;s>o;o++)i=h[o],r=i.render=u._renderSurface(i,n,e),!u.cullBackfaces||!i.cullBackfaces||r.projected.normal.z<0?(r.fill=null!=(a=i.fill)?a.render(u.lights,u.shader,r.transformed):void 0,r.stroke=null!=(p=i.stroke)?p.render(u.lights,u.shader,r.transformed):void 0,c.push(u.surfaces.push(i))):c.push(void 0);return c}),this.surfaces.sort(function(t,n){return n.render.projected.barycenter.z-t.render.projected.barycenter.z}),this.surfaces},t.prototype._renderSurface=function(t,n,r){var e;return e=this.renderModelCache[t.id],null==e?e=this.renderModelCache[t.id]=new p.RenderSurface(t.points,n,r):e.update(n,r),e},t}()}.call(this);