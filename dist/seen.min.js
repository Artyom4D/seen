!function(){var t,n;t=null!=(n="undefined"!=typeof exports&&null!==exports?exports:this).seen?(n="undefined"!=typeof exports&&null!==exports?exports:this).seen:n.seen={},function(){var n,e,r,i,o,s,u;return n=new Array(16),e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=function(){function t(t){return this.m=null!=t?t:null,null==this.m&&(this.m=e.slice()),this}return t.prototype.copy=function(){return new t(this.m.slice())},t.prototype.reset=function(){return this.m=e.slice(),this},t.prototype._multiplyM=function(t){var e,r,i,o,s;for(e=n,i=o=0;4>o;i=++o)for(r=s=0;16>s;r=s+=4)e[r+i]=t[r]*this.m[i]+t[r+1]*this.m[4+i]+t[r+2]*this.m[8+i]+t[r+3]*this.m[12+i];return n=this.m,this.m=e,this},t.prototype._rotx=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1],this._multiplyM(e)},t.prototype._roty=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1],this._multiplyM(e)},t.prototype._rotz=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1],this._multiplyM(e)},t.prototype._translate=function(t,n,e){return null==t&&(t=0),null==n&&(n=0),null==e&&(e=0),this.m[3]+=t,this.m[7]+=n,this.m[11]+=e,this},t.prototype._scale=function(t,n,e){return null==t&&(t=1),null==n&&(n=t),null==e&&(e=n),this.m[0]*=t,this.m[5]*=n,this.m[10]*=e,this},t.prototype.multiply=function(t){return this.multiplyM(t.m)},t.prototype.multiplyM=function(t){return this.copy()._multiplyM(t)},t.prototype.rotx=function(t){return this.copy()._rotx(t)},t.prototype.roty=function(t){return this.copy()._roty(t)},t.prototype.rotz=function(t){return this.copy()._rotz(t)},t.prototype.translate=function(t,n,e){return this.copy()._translate(t,n,e)},t.prototype.scale=function(t,n){return this.copy()._scale(t,n,t)},t}(),t.Matrices={identity:new r,flipX:(new r)._scale(-1,1,1),flipY:(new r)._scale(1,-1,1),flipZ:(new r)._scale(1,1,-1)},u=function(){function t(){this.m=new r}return t.prototype.scale=function(t,n,e){return this.m._scale(t,n,e),this},t.prototype.translate=function(t,n,e){return this.m._translate(t,n,e),this},t.prototype.rotx=function(t){return this.m._rotx(t),this},t.prototype.roty=function(t){return this.m._roty(t),this},t.prototype.rotz=function(t){return this.m._rotz(t),this},t.prototype.matrix=function(t){return this.m._multiplyM(t),this},t.prototype.transform=function(t){return this.m._multiply(t),this},t.prototype.reset=function(){return this.m.reset(),this},t}(),o=function(){function t(t,n,e,r){this.x=null!=t?t:0,this.y=null!=n?n:0,this.z=null!=e?e:0,this.w=null!=r?r:1}return t.prototype.transform=function(t){var n;return n=i,n.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],n.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],n.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],n.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(n),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copy=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.normalize=function(){return this.copy()._normalize()},t.prototype.add=function(t){return this.copy()._add(t)},t.prototype.subtract=function(t){return this.copy()._subtract(t)},t.prototype.multiply=function(t){return this.copy()._multiply(t)},t.prototype.divide=function(t){return this.copy()._divide(t)},t.prototype.cross=function(t){return this.copy()._cross(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype._multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype._divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype._normalize=function(){var t;return t=Math.sqrt(this.dot(this)),0===t?this.set(s.Z):this._divide(t),this},t.prototype._add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype._subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype._cross=function(t){var n;return n=i,n.x=this.y*t.z-this.z*t.y,n.y=this.z*t.x-this.x*t.z,n.z=this.x*t.y-this.y*t.x,this.set(n),this},t.prototype.toJSON=function(){return[this.x,this.y,this.z,this.w]},t}(),s={X:new o(1,0,0),Y:new o(0,1,0),Z:new o(0,0,1),EYE:new o(0,0,-1),ZERO:new o(0,0,0)},i=new o,t.Matrix=r,t.Point=o,t.Points=s,t.Transformable=u}()}.call(this),function(){var t,n,e=function(t,n){return function(){return t.apply(n,arguments)}},r={}.hasOwnProperty,i=function(t,n){function e(){this.constructor=t}for(var i in n)r.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},o=[].slice;t=null!=(n="undefined"!=typeof exports&&null!==exports?exports:this).seen?(n="undefined"!=typeof exports&&null!==exports?exports:this).seen:n.seen={},function(){var n,r,s,u,h=this;return r=function(){function n(t,n,e){this.points=t,this.transform=n,this.projection=e,this.transformed=this._initTransformationSet(),this.projected=this._initTransformationSet(),this._update()}return n.prototype.update=function(t,n){return this._arraysEqual(t.m,this.transform.m)&&this._arraysEqual(n.m,this.projection.m)?void 0:(this.transform=t,this.projection=n,this._update())},n.prototype._update=function(){return this._math(this.transformed,this.points,this.transform,!1),this._math(this.projected,this.transformed.points,this.projection,!0)},n.prototype._arraysEqual=function(t,n){var e,r,i,o;if(!t.length===n.length)return!1;for(e=i=0,o=t.length;o>i;e=++i)if(r=t[e],r!==n[e])return!1;return!0},n.prototype._initTransformationSet=function(){var n;return{points:function(){var t,e,r,i;for(r=this.points,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(n.copy());return i}.call(this),barycenter:new t.Point,normal:new t.Point,v0:new t.Point,v1:new t.Point}},n.prototype._math=function(n,e,r,i){var o,s,u,h,a,p,l,c;for(null==i&&(i=!1),o=h=0,p=e.length;p>h;o=++h)s=e[o],u=n.points[o],u.set(s).transform(r),i&&u._divide(u.w);for(n.barycenter.set(t.Points.ZERO),c=n.points,a=0,l=c.length;l>a;a++)s=c[a],n.barycenter._add(s);return n.barycenter._divide(n.points.length),n.v0.set(n.points[1])._subtract(n.points[0]),n.v1.set(n.points[e.length-1])._subtract(n.points[0]),n.normal.set(n.v0._cross(n.v1)._normalize())},n}(),t.PathPainter={paint:function(n,e,r){return r.path().path(e.projected.points).style({fill:null==e.fill?"none":t.Colors.toHexRgb(e.fill),stroke:null==e.stroke?"none":t.Colors.toHexRgb(e.stroke)})}},t.TextPainter={paint:function(n,e,r){return r.text().text(n.text).transform(e.transform.multiply(e.projection)).style({fill:null==e.fill?"none":t.Colors.toHexRgb(e.fill),stroke:null==e.stroke?"none":t.Colors.toHexRgb(e.stroke)})}},u=function(){function n(n,e){this.points=n,this.painter=null!=e?e:t.PathPainter,this.fill=t.Colors.white}return n.prototype.ignoreBackfaceCulling=!1,n.prototype.getRenderSurface=function(t,n){return null==this.render?this.render=new r(this.points,t,n):this.render.update(t,n),this.render},n}(),s=function(t){function n(t,r){this.type=t,this.surfaces=r,this.toJSON=e(this.toJSON,this),n.__super__.constructor.call(this)}return i(n,t),n.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},n.prototype.fill=function(t){return this.eachSurface(function(n){return n.fill=t}),this},n.prototype.stroke=function(t){return this.eachSurface(function(n){return n.stroke=t}),this},n.prototype.toJSON=function(){var t,n;return"custom"===this.type?{type:this.type,transforms:[["matrix",this.m.m]],surfaces:function(){var e,r,i,o;for(i=this.surfaces,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(function(){var e,r,i,o;for(i=n.points,o=[],e=0,r=i.length;r>e;e++)t=i[e],o.push(t.toJSON());return o}());return o}.call(this)}:{type:this.type,transforms:[["matrix",this.m.m]]}},n}(t.Transformable),n=function(t){function n(){n.__super__.constructor.call(this),this.children=[]}return i(n,t),n.prototype.add=function(t){return this.children.push(t),this},n.prototype.append=function(){var t;return t=new n,this.add(t),t},n.prototype.eachShape=function(t){var e,r,i,o,u;for(o=this.children,u=[],r=0,i=o.length;i>r;r++)e=o[r],e instanceof s&&t.call(this,e),e instanceof n?u.push(e.eachTransformedShape(t)):u.push(void 0);return u},n.prototype.eachTransformedShape=function(t,e){var r,i,o,u,h;for(null==e&&(e=null),null==e&&(e=this.m),u=this.children,h=[],i=0,o=u.length;o>i;i++)r=u[i],r instanceof s&&t.call(this,r,r.m.multiply(e)),r instanceof n?h.push(r.eachTransformedShape(t,r.m.multiply(e))):h.push(void 0);return h},n}(t.Transformable),t.Shapes={_cubeCoordinateMap:[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],_mapPointsToSurfaces:function(t,n){var e,r,i,o,s,h;for(o=[],s=0,h=n.length;h>s;s++)r=n[s],i=function(){var n,i,o;for(o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t[e].copy());return o}(),o.push(new u(i));return o},joints:function(t,e){var r,i,o,s;for(null==e&&(e=this.unitcube),r=new n,o=[],i=s=0;t>=0?t>s:s>t;i=t>=0?++s:--s)o.push(r),r=r.append().translate(-.5,-1,-.5).add(e()).append().translate(.5,0,.5).append();return o},bipedSkeleton:function(t){var n,e,r,i,o;return null==t&&(t=h.unitcube),i=function(){var n;return n=h.joints(3,t),{upperBody:n[0],torso:n[1],pelvis:n[2]}},e=function(){var n;return n=h.joints(4,t),{shoulder:n[0],upperArm:n[1],elbow:n[2],foreArm:n[3]}},r=function(){var n;return n=h.joints(4,t),{upperLeg:n[0],knee:n[1],lowerLeg:n[2],foot:n[3]}},n=function(t,n,e){var r;return r=t.append().translate(e).append(),r.append().translate(e).add(n),r},o=i(),o.root=o.upperBody,o.leftArm=e(),o.rightArm=e(),o.leftLeg=r(),o.rightLeg=r(),o.leftShoulder=n(o.upperBody,o.leftArm.shoulder,.5),o.rightShoulder=n(o.upperBody,o.rightArm.shoulder,-.5),o.leftHip=n(o.pelvis,o.leftLeg.upperLeg,.5),o.rightHip=n(o.pelvis,o.rightLeg.upperLeg,-.5),o},cube:function(){var n;return n=[new t.Point(-1,-1,-1),new t.Point(-1,-1,1),new t.Point(-1,1,-1),new t.Point(-1,1,1),new t.Point(1,-1,-1),new t.Point(1,-1,1),new t.Point(1,1,-1),new t.Point(1,1,1)],new s("cube",t.Shapes._mapPointsToSurfaces(n,t.Shapes._cubeCoordinateMap))},unitcube:function(){var n;return n=[new t.Point(0,0,0),new t.Point(0,0,1),new t.Point(0,1,0),new t.Point(0,1,1),new t.Point(1,0,0),new t.Point(1,0,1),new t.Point(1,1,0),new t.Point(1,1,1)],new s("unitcube",t.Shapes._mapPointsToSurfaces(n,t.Shapes._cubeCoordinateMap))},rectangle:function(n,e){var r,i;return r=function(r,i,o){return new t.Point(r(n.x,e.x),i(n.y,e.y),o(n.z,e.z))},i=[r(Math.min,Math.min,Math.min),r(Math.min,Math.min,Math.max),r(Math.min,Math.max,Math.min),r(Math.min,Math.max,Math.max),r(Math.max,Math.min,Math.min),r(Math.max,Math.min,Math.max),r(Math.max,Math.max,Math.min),r(Math.max,Math.max,Math.max)],new s("rect",t.Shapes._mapPointsToSurfaces(i,t.Shapes._cubeCoordinateMap))},tetrahedron:function(){var n,e;return e=[new t.Point(1,1,1),new t.Point(-1,-1,1),new t.Point(-1,1,-1),new t.Point(1,-1,-1)],n=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],new s("tetrahedron",t.Shapes._mapPointsToSurfaces(e,n))},text:function(n){var e;return e=new u([new t.Point(0,0,-1),new t.Point(0,20,-1),new t.Point(20,0,-1)],t.TextPainter),e.text=n,e.ignoreBackfaceCulling=!0,new s("text",[e])},custom:function(n){var e,r,i,o,h,a;for(i=[],a=n.surfaces,o=0,h=a.length;h>o;o++)e=a[o],i.push(new u(function(){var n,i,o;for(o=[],n=0,i=e.length;i>n;n++)r=e[n],o.push(function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(t.Point,r,function(){}));return o}()));return new s("custom",i)},fromJSON:function(t){var n,e,r,i,s,u;for(n=this[t.type](t),s=t.transforms,r=0,i=s.length;i>r;r++)e=s[r],(u=n[e[0]]).call.apply(u,[n].concat(o.call(e.slice(1))));return n}},t.RenderSurface=r,t.Group=n,t.Surface=u,t.Shape=s}()}.call(this),function(){var t,n;t=null!=(n="undefined"!=typeof exports&&null!==exports?exports:this).seen?(n="undefined"!=typeof exports&&null!==exports?exports:this).seen:n.seen={},t.Projections={perspectiveFov:function(n,e){var r;return null==n&&(n=50),null==e&&(e=100),r=e*Math.tan(n*Math.PI/360),t.Projections.perspective(-r,r,-r,r,e,2*e)},orthoExtent:function(n){return null==n&&(n=100),t.Projections.ortho(-n,n,-n,n,n,2*n)},perspective:function(n,e,r,i,o,s){var u,h,a,p,l;return l=2*o,u=e-n,h=i-r,a=s-o,p=new Array(16),p[0]=l/u,p[1]=0,p[2]=(e+n)/u,p[3]=0,p[4]=0,p[5]=l/h,p[6]=(i+r)/h,p[7]=0,p[8]=0,p[9]=0,p[10]=-(s+o)/a,p[11]=-(s*l)/a,p[12]=0,p[13]=0,p[14]=-1,p[15]=0,new t.Matrix(p)},ortho:function(n,e,r,i,o,s){var u,h,a,p,l;return l=2*o,u=e-n,h=i-r,a=s-o,p=new Array(16),p[0]=2/u,p[1]=0,p[2]=0,p[3]=(e+n)/u,p[4]=0,p[5]=2/h,p[6]=0,p[7]=-(i+r)/h,p[8]=0,p[9]=0,p[10]=-2/a,p[11]=-(s+o)/a,p[12]=0,p[13]=0,p[14]=0,p[15]=1,new t.Matrix(p)}},t.Viewports={centerOrigin:function(n,e,r,i){return null==n&&(n=500),null==e&&(e=500),null==r&&(r=0),null==i&&(i=0),(new t.Matrix).scale(n/2,-e/2).translate(r+n/2,i+e/2)}}}.call(this),function(){var t,n,e=function(t,n){return function(){return t.apply(n,arguments)}},r={}.hasOwnProperty,i=function(t,n){function e(){this.constructor=t}for(var i in n)r.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};t=null!=(n="undefined"!=typeof exports&&null!==exports?exports:this).seen?(n="undefined"!=typeof exports&&null!==exports?exports:this).seen:n.seen={},function(){var n,r,o,s;return n=function(){function n(t,n,e,r){this.r=null!=t?t:0,this.g=null!=n?n:0,this.b=null!=e?e:0,this.a=null!=r?r:255}return n.prototype.toJSON=function(){return t.Colors.toHexRgb(this)},n.prototype.toHexRgb=function(){return t.Colors.toHexRgb(this)},n.prototype.toStyle=function(){return t.Colors.toStyle(this)},n}(),r=function(){function t(){this.defaultFill=this.fromHsl(.7,1,.5),this.defaultStroke=null,this.black=new n(0,0,0),this.white=new n(255,255,255)}return t.prototype.fromRgb=function(t,e,r){return new n(t,e,r)},t.prototype.fromHex=function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new n(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},t.prototype.fromHsl=function(t,e,r){var i,o,s,u,h,a;return a=o=i=0,0===e?a=o=i=r:(s=function(t,n,e){return 0>e?e+=1:e>1&&(e-=1),1/6>e?t+6*(n-t)*e:.5>e?n:2/3>e?t+6*(n-t)*(2/3-e):t},h=.5>r?r*(1+e):r+e-r*e,u=2*r-h,a=s(u,h,t+1/3),o=s(u,h,t),i=s(u,h,t-1/3)),new n(255*a,255*o,255*i)},t.prototype.toHexRgb=function(t){var n;for(n=(t.r<<16|t.g<<8|t.b).toString(16);n.length<6;)n="0"+n;return"#"+n},t.prototype.toStyle=function(t){return"rgba({0},{1},{2},{3})".format(t.r,t.g,t.b,t.a)},t}(),o=function(n){function r(n){this.transform=e(this.transform,this),t.Util.defaults(this,n,{point:new t.Point,color:t.Colors.white,intensity:.01,exponent:8})}return i(r,n),r.prototype.transform=function(t){return this.point.transform(t)},r}(t.Transformable),s=function(){function r(){this.getFaceColor=e(this.getFaceColor,this)}return r.prototype.getFaceColor=function(e,r,i){var o,s,u,h,a,p,l,c,f,y,d,m;for(u=new n,d=e.points,l=0,f=d.length;f>l;l++)a=d[l],o=a.point.subtract(r.barycenter).normalize(),h=o.dot(r.normal),h>0&&(u.r+=a.color.r*h*a.intensity,u.g+=a.color.g*h*a.intensity,u.b+=a.color.b*h*a.intensity,s=r.normal.multiply(2*h).subtract(o),p=Math.pow(1+s.dot(t.Points.Z),a.exponent),u.r+=p*a.intensity,u.g+=p*a.intensity,u.b+=p*a.intensity);for(m=e.ambients,c=0,y=m.length;y>c;c++)a=m[c],u.r+=a.color.r*a.intensity,u.g+=a.color.g*a.intensity,u.b+=a.color.b*a.intensity;return u.r=Math.min(255,i.r*u.r),u.g=Math.min(255,i.g*u.g),u.b=Math.min(255,i.b*u.b),u},r}(),t.Color=n,t.Colors=new r,t.Light=o,t.Shaders={},t.Shaders.Phong=s}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};!function(){var n,e,r,i;return r=function(t){return $(i(t))},i=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},e=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),n=function(){function t(t){this.g=t,this._i=0,this._g=this.g[0]}return t.prototype.hideUnused=function(){var t,n;for(t=this._g.childNodes,n=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),n.push(this._i++);return n},t.prototype.path=function(){var t;return t=this._manifest("path"),{el:t,path:function(n){return t.setAttribute("d",e(n)),this},style:function(n){return t.setAttribute("style","fill: "+n.fill+"; stroke: "+n.stroke+";"),this}}},t.prototype.text=function(){var t;return t=this._manifest("text"),t.setAttribute("text-anchor","middle"),t.setAttribute("font-family","Roboto"),{el:t,text:function(n){return t.textContent=n,this},style:function(n){return t.setAttribute("style","fill: "+n.fill+"; stroke: "+n.stroke+";"),this},transform:function(n){var e;return e=n.m,t.setAttribute("transform","matrix("+e[0]+" "+e[4]+" "+e[1]+" "+e[5]+" "+e[3]+" "+e[7]+")"),this}}},t.prototype._manifest=function(t){var n,e,r;return n=this._g.childNodes,this._i>=n.length?(r=i(t),this._g.appendChild(r),this._i++,r):(e=n[this._i],e.tagName===t?(this._i++,e):(r=i(t),this._g.replaceChild(r,e),this._i++,r))},t}(),seen.SvgCanvas=function(){function e(n){this.svg=n,this.render=t(this.render,this),this.layers={background:r("g").addClass("background").appendTo(this.svg),scene:r("g").addClass("scene").appendTo(this.svg),overlay:r("g").addClass("overlay").appendTo(this.svg)}}return e.prototype.width=500,e.prototype.height=500,e.prototype.add=function(t){return"function"==typeof t.addTo&&t.addTo(this),this},e.prototype.render=function(t){var e,r,i,o;for(e=new n(this.layers.scene),i=0,o=t.length;o>i;i++)r=t[i],r.painter.paint(r,r.render,e);e.hideUnused()},e}(),seen.SvgRenderDebug=function(){function n(n){this._renderEnd=t(this._renderEnd,this),this._renderStart=t(this._renderStart,this),this._text=r("text").css("text-anchor","end").attr("y",20),this._fps=30,n.on("beforeRender.debug",this._renderStart),n.on("afterRender.debug",this._renderEnd)}return n.prototype.addTo=function(t){return this._text.attr("x",t.width-10).appendTo(t.layers.overlay)},n.prototype._renderStart=function(){return this._renderStartTime=new Date},n.prototype._renderEnd=function(t){var n;return n=1e3/(new Date-this._renderStartTime),0/0!==n&&(this._fps+=(n-this._fps)/20),this._text.text("fps: "+this._fps.toFixed(1)+" surfaces: "+t.surfaces.length)},n}(),seen.SvgFillRect=function(){function t(){}return t.prototype.addTo=function(t){return r("rect").css("fill","#EEE").attr({width:t.width,height:t.height}).appendTo(t.layers.background)},t}()}()}.call(this),function(){var t,n,e=function(t,n){return function(){return t.apply(n,arguments)}};t=null!=(n="undefined"!=typeof exports&&null!==exports?exports:this).seen?(n="undefined"!=typeof exports&&null!==exports?exports:this).seen:n.seen={},t.Util={defaults:function(t,n,e){var r,i;for(r in n)null==t[r]&&(t[r]=n[r]);i=[];for(r in e)null==t[r]?i.push(t[r]=e[r]):i.push(void 0);return i}},t.Scene=function(){function n(n){this.renderSurfaces=e(this.renderSurfaces,this),this.render=e(this.render,this),t.Util.defaults(this,n,this.defaults),this.dispatch=d3.dispatch("beforeRender","afterRender"),d3.rebind(this,this.dispatch,["on"]),this.group=new t.Group,this.shader=new t.Shaders.Phong,this.lights={points:[],ambients:[]}}return n.prototype.defaults={cullBackfaces:!0,projection:t.Projections.perspective(-100,100,-100,100,100,300),viewport:t.Viewports.centerOrigin(500,500)},n.prototype.startRenderLoop=function(t){return null==t&&(t=30),setInterval(this.render,t)},n.prototype.render=function(){var t;return this.dispatch.beforeRender(),t=this.renderSurfaces(),this.canvas.render(t),this.dispatch.afterRender({surfaces:t}),this},n.prototype.renderSurfaces=function(t){var n,e=this;return null==t&&(t=null),n=null==t?this.projection:t.multiply(this.projection),n=n.multiply(this.viewport),this.surfaces=[],this.group.eachTransformedShape(function(t,r){var i,o,s,u,h,a;for(h=t.surfaces,a=[],s=0,u=h.length;u>s;s++)o=h[s],i=o.getRenderSurface(r,n),!e.cullBackfaces||o.ignoreBackfaceCulling||i.projected.normal.z<0?(null!=o.fill&&(i.fill=e.shader.getFaceColor(e.lights,i.transformed,o.fill)),null!=o.stroke&&(i.stroke=o.stroke),a.push(e.surfaces.push(o))):a.push(void 0);return a}),this.surfaces.sort(function(t,n){return n.render.projected.barycenter.z-t.render.projected.barycenter.z}),this.surfaces},n}()}.call(this);