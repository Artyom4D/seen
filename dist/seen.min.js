!function(){var t,e;t=null!=(e="undefined"!=typeof exports&&null!==exports?exports:this).seen?(e="undefined"!=typeof exports&&null!==exports?exports:this).seen:e.seen={}}.call(this),function(){seen.Util={defaults:function(t,e,n){var r,s;for(r in e)null==t[r]&&(t[r]=e[r]);s=[];for(r in n)null==t[r]?s.push(t[r]=n[r]):s.push(void 0);return s}}}.call(this),function(){var t,e,n;t=new Array(16),e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],seen.Matrix=function(){function n(t){return this.m=null!=t?t:null,null==this.m&&(this.m=e.slice()),this}return n.prototype.copy=function(){return new seen.Matrix(this.m.slice())},n.prototype.reset=function(){return this.m=e.slice(),this},n.prototype._multiply=function(t){return this._multiplyM(t.m)},n.prototype._multiplyM=function(e){var n,r,s,i,o;for(n=t,s=i=0;4>i;s=++i)for(r=o=0;16>o;r=o+=4)n[r+s]=e[r]*this.m[s]+e[r+1]*this.m[4+s]+e[r+2]*this.m[8+s]+e[r+3]*this.m[12+s];return t=this.m,this.m=n,this},n.prototype._rotx=function(t){var e,n,r;return e=Math.cos(t),r=Math.sin(t),n=[1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1],this._multiplyM(n)},n.prototype._roty=function(t){var e,n,r;return e=Math.cos(t),r=Math.sin(t),n=[e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1],this._multiplyM(n)},n.prototype._rotz=function(t){var e,n,r;return e=Math.cos(t),r=Math.sin(t),n=[e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1],this._multiplyM(n)},n.prototype._translate=function(t,e,n){return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),this.m[3]+=t,this.m[7]+=e,this.m[11]+=n,this},n.prototype._scale=function(t,e,n){return null==t&&(t=1),null==e&&(e=t),null==n&&(n=e),this.m[0]*=t,this.m[5]*=e,this.m[10]*=n,this},n.prototype.multiply=function(t){return this.copy()._multiply(t)},n.prototype.multiplyM=function(t){return this.copy()._multiplyM(t)},n.prototype.rotx=function(t){return this.copy()._rotx(t)},n.prototype.roty=function(t){return this.copy()._roty(t)},n.prototype.rotz=function(t){return this.copy()._rotz(t)},n.prototype.translate=function(t,e,n){return this.copy()._translate(t,e,n)},n.prototype.scale=function(t,e){return this.copy()._scale(t,e,t)},n}(),seen.M=function(){return function(t,e,n){n.prototype=t.prototype;var r=new n,s=t.apply(r,e);return Object(s)===s?s:r}(seen.Matrix,arguments,function(){})},seen.Matrices={identity:seen.M(),flipX:seen.M()._scale(-1,1,1),flipY:seen.M()._scale(1,-1,1),flipZ:seen.M()._scale(1,1,-1)},seen.Transformable=function(){function t(){this.m=new seen.Matrix}return t.prototype.scale=function(t,e,n){return this.m._scale(t,e,n),this},t.prototype.translate=function(t,e,n){return this.m._translate(t,e,n),this},t.prototype.rotx=function(t){return this.m._rotx(t),this},t.prototype.roty=function(t){return this.m._roty(t),this},t.prototype.rotz=function(t){return this.m._rotz(t),this},t.prototype.matrix=function(t){return this.m._multiplyM(t),this},t.prototype.transform=function(t){return this.m._multiply(t),this},t.prototype.reset=function(){return this.m.reset(),this},t}(),seen.Point=function(){function t(t,e,n,r){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=n?n:0,this.w=null!=r?r:1}return t.prototype.transform=function(t){var e;return e=n,e.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],e.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],e.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],e.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(e),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copy=function(){return new seen.Point(this.x,this.y,this.z,this.w)},t.prototype.normalize=function(){return this.copy()._normalize()},t.prototype.add=function(t){return this.copy()._add(t)},t.prototype.subtract=function(t){return this.copy()._subtract(t)},t.prototype.cross=function(t){return this.copy()._cross(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.multiply=function(t){return this.copy()._multiply(t)},t.prototype.divide=function(t){return this.copy()._divide(t)},t.prototype._multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype._divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype._normalize=function(){var t;return t=Math.sqrt(this.dot(this)),0===t?this.set(Points.Z):this._divide(t),this},t.prototype._add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype._subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype._cross=function(t){var e;return e=n,e.x=this.y*t.z-this.z*t.y,e.y=this.z*t.x-this.x*t.z,e.z=this.x*t.y-this.y*t.x,this.set(e),this},t.prototype.toJSON=function(){return[this.x,this.y,this.z,this.w]},t}(),seen.P=function(){return function(t,e,n){n.prototype=t.prototype;var r=new n,s=t.apply(r,e);return Object(s)===s?s:r}(seen.Point,arguments,function(){})},n=seen.P(),seen.Points={X:seen.P(1,0,0),Y:seen.P(0,1,0),Z:seen.P(0,0,1),ZERO:seen.P(0,0,0)}}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var s in e)n.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};seen.Color=function(){function t(t,e,n,r){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=n?n:0,this.a=null!=r?r:255}return t.prototype.hex=function(){var t;for(t=(this.r<<16|this.g<<8|this.b).toString(16);t.length<6;)t="0"+t;return"#"+t},t.prototype.style=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t.prototype.clear=function(){return this.r=this.g=this.b=0,this},t}(),seen.Colors={rgb:function(t,e,n,r){return new seen.Color(t,e,n,r)},hex:function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new seen.Color(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},hsl:function(t,e,n){var r,s,i,o,u,a;return a=s=r=0,0===e?a=s=r=n:(i=function(t,e,n){return 0>n?n+=1:n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+6*(e-t)*(2/3-n):t},u=.5>n?n*(1+e):n+e-n*e,o=2*n-u,a=i(o,u,t+1/3),s=i(o,u,t),r=i(o,u,t-1/3)),new seen.Color(255*a,255*s,255*r)}},seen.C=seen.Colors,seen.C.black=seen.C.hex("#000000"),seen.C.white=seen.C.hex("#FFFFFF"),seen.C.gray=seen.C.hex("#888888"),seen.Light=function(t){function n(t){this.transform=e(this.transform,this),seen.Util.defaults(this,t,{point:seen.P(),color:seen.C.white,intensity:.01,exponent:8})}return r(n,t),n.prototype.transform=function(t){return this.point.transform(t)},n}(seen.Transformable),t=function(){function t(){}return t.prototype.getFaceColor=function(t,e,n){var r;return r=new seen.Color,n},t}(),seen.Shaders={phong:new t}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};seen.RenderSurface=function(){function t(t,e,n){this.points=t,this.transform=e,this.projection=n,this.transformed=this._initTransformationSet(),this.projected=this._initTransformationSet(),this._update()}return t.prototype.update=function(t,e){return this._arraysEqual(t.m,this.transform.m)&&this._arraysEqual(e.m,this.projection.m)?void 0:(this.transform=t,this.projection=e,this._update())},t.prototype._update=function(){return this._math(this.transformed,this.points,this.transform,!1),this._math(this.projected,this.transformed.points,this.projection,!0)},t.prototype._arraysEqual=function(t,e){var n,r,s,i;if(!t.length===e.length)return!1;for(n=s=0,i=t.length;i>s;n=++s)if(r=t[n],r!==e[n])return!1;return!0},t.prototype._initTransformationSet=function(){var t;return{points:function(){var e,n,r,s;for(r=this.points,s=[],e=0,n=r.length;n>e;e++)t=r[e],s.push(t.copy());return s}.call(this),barycenter:seen.P(),normal:seen.P(),v0:seen.P(),v1:seen.P()}},t.prototype._math=function(t,e,n,r){var s,i,o,u,a,h,p,c;for(null==r&&(r=!1),s=u=0,h=e.length;h>u;s=++u)i=e[s],o=t.points[s],o.set(i).transform(n),r&&o._divide(o.w);for(t.barycenter.set(seen.Points.ZERO),c=t.points,a=0,p=c.length;p>a;a++)i=c[a],t.barycenter._add(i);return t.barycenter._divide(t.points.length),t.v0.set(t.points[1])._subtract(t.points[0]),t.v1.set(t.points[e.length-1])._subtract(t.points[0]),t.normal.set(t.v0._cross(t.v1)._normalize())},t}(),seen.Surface=function(){function e(e,n){this.points=e,this.painter=null!=n?n:seen.Painters.path,this.getRenderSurface=t(this.getRenderSurface,this)}return e.prototype.cullBackfaces=!0,e.prototype.fill=seen.C.gray,e.prototype.stroke=null,e.prototype.getRenderSurface=function(t,e){return null==this.render?this.render=new seen.RenderSurface(this.points,t,e):this.render.update(t,e),this.render},e}(),seen.Shape=function(t){function e(t,n){this.type=t,this.surfaces=n,e.__super__.constructor.call(this)}return n(e,t),e.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},e.prototype.fill=function(t){return this.eachSurface(function(e){return e.fill=t}),this},e.prototype.stroke=function(t){return this.eachSurface(function(e){return e.stroke=t}),this},e}(seen.Transformable),seen.Group=function(t){function e(){e.__super__.constructor.call(this),this.children=[]}return n(e,t),e.prototype.add=function(t){return this.children.push(t),this},e.prototype.append=function(){var t;return t=new seen.Group,this.add(t),t},e.prototype.eachShape=function(t){var e,n,r,s,i;for(s=this.children,i=[],n=0,r=s.length;r>n;n++)e=s[n],e instanceof seen.Shape&&t.call(this,e),e instanceof seen.Group?i.push(e.eachTransformedShape(t)):i.push(void 0);return i},e.prototype.eachTransformedShape=function(t,e){var n,r,s,i,o;for(null==e&&(e=null),null==e&&(e=this.m),i=this.children,o=[],r=0,s=i.length;s>r;r++)n=i[r],n instanceof seen.Shape&&t.call(this,n,n.m.multiply(e)),n instanceof seen.Group?o.push(n.eachTransformedShape(t,n.m.multiply(e))):o.push(void 0);return o},e}(seen.Transformable)}.call(this),function(){var t,e,n,r,s={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};seen.Painter=function(){function t(){}return t.prototype.paint=function(){},t}(),t=function(t){function e(){return n=e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.paint=function(t,e,n){var r;return n.path().path(e.projected.points).style({fill:null==e.fill?"none":e.fill.hex(),stroke:null==e.stroke?"none":e.stroke.hex(),"fill-opacity":null==t.fill?1:t.fill.a/255,"stroke-width":null!=(r=t["stroke-width"])?r:1})},e}(seen.Painter),e=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.paint=function(t,e,n){var r;return n.text().text(t.text).transform(e.transform.multiply(e.projection)).style({fill:null==e.fill?"none":e.fill.hex(),stroke:null==e.stroke?"none":e.stroke.hex(),"text-anchor":null!=(r=t.anchor)?r:"middle"})},e}(seen.Painter),seen.Painters={path:new t,text:new e}}.call(this),function(){var t=this;seen.Shapes={_cubeCoordinateMap:[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],_mapPointsToSurfaces:function(t,e){var n,r,s,i,o,u;for(i=[],o=0,u=e.length;u>o;o++)r=e[o],s=function(){var e,s,i;for(i=[],e=0,s=r.length;s>e;e++)n=r[e],i.push(t[n].copy());return i}(),i.push(new seen.Surface(s));return i},joints:function(t,e){var n,r,s,i;for(null==e&&(e=this.unitcube),n=new seen.Group,s=[],r=i=0;t>=0?t>i:i>t;r=t>=0?++i:--i)s.push(n),n=n.append().translate(-.5,-1,-.5).add(e()).append().translate(.5,0,.5).append();return s},bipedSkeleton:function(e){var n,r,s,i,o;return null==e&&(e=t.unitcube),i=function(){var n;return n=t.joints(3,e),{upperBody:n[0],torso:n[1],pelvis:n[2]}},r=function(){var n;return n=t.joints(4,e),{shoulder:n[0],upperArm:n[1],elbow:n[2],foreArm:n[3]}},s=function(){var n;return n=t.joints(4,e),{upperLeg:n[0],knee:n[1],lowerLeg:n[2],foot:n[3]}},n=function(t,e,n){var r;return r=t.append().translate(n).append(),r.append().translate(n).add(e),r},o=i(),o.root=o.upperBody,o.leftArm=r(),o.rightArm=r(),o.leftLeg=s(),o.rightLeg=s(),o.leftShoulder=n(o.upperBody,o.leftArm.shoulder,.5),o.rightShoulder=n(o.upperBody,o.rightArm.shoulder,-.5),o.leftHip=n(o.pelvis,o.leftLeg.upperLeg,.5),o.rightHip=n(o.pelvis,o.rightLeg.upperLeg,-.5),o},cube:function(){var t;return t=[seen.P(-1,-1,-1),seen.P(-1,-1,1),seen.P(-1,1,-1),seen.P(-1,1,1),seen.P(1,-1,-1),seen.P(1,-1,1),seen.P(1,1,-1),seen.P(1,1,1)],new seen.Shape("cube",seen.Shapes._mapPointsToSurfaces(t,seen.Shapes._cubeCoordinateMap))},unitcube:function(){var t;return t=[seen.P(0,0,0),seen.P(0,0,1),seen.P(0,1,0),seen.P(0,1,1),seen.P(1,0,0),seen.P(1,0,1),seen.P(1,1,0),seen.P(1,1,1)],new seen.Shape("unitcube",seen.Shapes._mapPointsToSurfaces(t,seen.Shapes._cubeCoordinateMap))},rectangle:function(t,e){var n,r;return n=function(n,r,s){return seen.P(n(t.x,e.x),r(t.y,e.y),s(t.z,e.z))},r=[n(Math.min,Math.min,Math.min),n(Math.min,Math.min,Math.max),n(Math.min,Math.max,Math.min),n(Math.min,Math.max,Math.max),n(Math.max,Math.min,Math.min),n(Math.max,Math.min,Math.max),n(Math.max,Math.max,Math.min),n(Math.max,Math.max,Math.max)],new seen.Shape("rect",seen.Shapes._mapPointsToSurfaces(r,seen.Shapes._cubeCoordinateMap))},tetrahedron:function(){var t,e;return e=[seen.P(1,1,1),seen.P(-1,-1,1),seen.P(-1,1,-1),seen.P(1,-1,-1)],t=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],new seen.Shape("tetrahedron",seen.Shapes._mapPointsToSurfaces(e,t))},text:function(t){var e;return e=new seen.Surface([seen.P(0,0,-1),seen.P(0,20,-1),seen.P(20,0,-1)],seen.Painters.text),e.text=t,e.cullBackfaces=!1,new seen.Shape("text",[e])},extrude:function(t,e){var n,r,s,i,o,u,a,h;for(null==e&&(e=1),u=[],r=new seen.Surface(function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],r.push(o.copy());return r}()),n=new seen.Surface(function(){var n,r,s;for(s=[],n=0,r=t.length;r>n;n++)o=t[n],s.push(o.translate(0,0,e));return s}()),s=a=1,h=t.length;h>=1?h>a:a>h;s=h>=1?++a:--a)u.push(new seen.Surface([r.points[s-1].copy(),n.points[s-1].copy(),n.points[s].copy(),r.points[s].copy()]));return i=t.length,u.push(new seen.Surface([r.points[i-1].copy(),n.points[i-1].copy(),n.points[0].copy(),r.points[0].copy()])),n.points.reverse(),u.push(r),u.push(n),new seen.Shape("extrusion",u)},arrow:function(t,e,n,r,s){var i,o;return null==t&&(t=1),null==e&&(e=1),null==n&&(n=1),null==r&&(r=1),null==s&&(s=0),i=n/2,o=[seen.P(0,0,0),seen.P(r+s,1,0),seen.P(r,i,0),seen.P(r+e,i,0),seen.P(r+e,-i,0),seen.P(r,-i,0),seen.P(r+s,-1,0)],seen.Shapes.extrude(o,t)},path:function(t){return new seen.Shape("path",[new seen.Surface(t)])},custom:function(t){var e,n,r,s,i,o;for(r=[],o=t.surfaces,s=0,i=o.length;i>s;s++)e=o[s],r.push(new seen.Surface(function(){var t,r,s;for(s=[],t=0,r=e.length;r>t;t++)n=e[t],s.push(seen.P.apply(seen,n));return s}()));return new seen.Shape("custom",r)}}}.call(this),function(){var t,e;t=null!=(e="undefined"!=typeof exports&&null!==exports?exports:this).seen?(e="undefined"!=typeof exports&&null!==exports?exports:this).seen:e.seen={},t.Projections={perspectiveFov:function(e,n){var r;return null==e&&(e=50),null==n&&(n=100),r=n*Math.tan(e*Math.PI/360),t.Projections.perspective(-r,r,-r,r,n,2*n)},orthoExtent:function(e){return null==e&&(e=100),t.Projections.ortho(-e,e,-e,e,e,2*e)},perspective:function(e,n,r,s,i,o){var u,a,h,p,c;return c=2*i,u=n-e,a=s-r,h=o-i,p=new Array(16),p[0]=c/u,p[1]=0,p[2]=(n+e)/u,p[3]=0,p[4]=0,p[5]=c/a,p[6]=(s+r)/a,p[7]=0,p[8]=0,p[9]=0,p[10]=-(o+i)/h,p[11]=-(o*c)/h,p[12]=0,p[13]=0,p[14]=-1,p[15]=0,new t.Matrix(p)},ortho:function(e,n,r,s,i,o){var u,a,h,p,c;return c=2*i,u=n-e,a=s-r,h=o-i,p=new Array(16),p[0]=2/u,p[1]=0,p[2]=0,p[3]=(n+e)/u,p[4]=0,p[5]=2/a,p[6]=0,p[7]=-(s+r)/a,p[8]=0,p[9]=0,p[10]=-2/h,p[11]=-(o+i)/h,p[12]=0,p[13]=0,p[14]=0,p[15]=1,new t.Matrix(p)}},t.Viewports={centerOrigin:function(e,n,r,s){return null==e&&(e=500),null==n&&(n=500),null==r&&(r=0),null==s&&(s=0),(new t.Matrix).scale(e/2,-n/2).translate(r+e/2,s+n/2)}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};!function(){var e,n,r,s;return r=function(t){return $(s(t))},s=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},n=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),e=function(){function t(t){this.g=t,this._i=0,this._g=this.g[0]}return t.prototype.hideUnused=function(){var t,e;for(t=this._g.childNodes,e=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),e.push(this._i++);return e},t.prototype.path=function(){var t;return t=this._manifest("path"),{el:t,path:function(e){return t.setAttribute("d",n(e)),this},style:function(e){var n,r,s;r="";for(n in e)s=e[n],r+=""+n+":"+s+";";return t.setAttribute("style",r),this}}},t.prototype.text=function(){var t;return t=this._manifest("text"),t.setAttribute("font-family","Roboto"),{el:t,text:function(e){return t.textContent=e,this},style:function(e){var n,r,s;r="";for(n in e)s=e[n],r+=""+n+":"+s+";";return t.setAttribute("style",r),this},transform:function(e){var n;return n=e.m,t.setAttribute("transform","matrix("+n[0]+" "+n[4]+" "+n[1]+" "+n[5]+" "+n[3]+" "+n[7]+")"),this}}},t.prototype._manifest=function(t){var e,n,r;return e=this._g.childNodes,this._i>=e.length?(r=s(t),this._g.appendChild(r),this._i++,r):(n=e[this._i],n.tagName===t?(this._i++,n):(r=s(t),this._g.replaceChild(r,n),this._i++,r))},t}(),seen.SvgCanvas=function(){function n(e){this.svg=e,this.render=t(this.render,this),this.layers={background:r("g").addClass("background").appendTo(this.svg),scene:r("g").addClass("scene").appendTo(this.svg),overlay:r("g").addClass("overlay").appendTo(this.svg)}}return n.prototype.width=500,n.prototype.height=500,n.prototype.add=function(t){return"function"==typeof t.addTo&&t.addTo(this),this},n.prototype.render=function(t){var n,r,s,i;for(n=new e(this.layers.scene),s=0,i=t.length;i>s;s++)r=t[s],r.painter.paint(r,r.render,n);n.hideUnused()},n}(),seen.SvgRenderDebug=function(){function e(e){this._renderEnd=t(this._renderEnd,this),this._renderStart=t(this._renderStart,this),this._text=r("text").css("text-anchor","end").attr("y",20),this._fps=30,e.on("beforeRender.debug",this._renderStart),e.on("afterRender.debug",this._renderEnd)}return e.prototype.addTo=function(t){return this._text.attr("x",t.width-10).appendTo(t.layers.overlay)},e.prototype._renderStart=function(){return this._renderStartTime=new Date},e.prototype._renderEnd=function(t){var e;return e=1e3/(new Date-this._renderStartTime),0/0!==e&&(this._fps+=(e-this._fps)/20),this._text.text("fps: "+this._fps.toFixed(1)+" surfaces: "+t.surfaces.length)},e}(),seen.SvgFillRect=function(){function t(){}return t.prototype.addTo=function(t){return r("rect").css("fill","#EEE").attr({width:t.width,height:t.height}).appendTo(t.layers.background)},t}()}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};seen.Scene=function(){function e(e){this.renderSurfaces=t(this.renderSurfaces,this),this.render=t(this.render,this),seen.Util.defaults(this,e,this.defaults),this.dispatch=d3.dispatch("beforeRender","afterRender"),d3.rebind(this,this.dispatch,["on"]),this.group=new seen.Group,this.shader=seen.Shaders.phong,this.lights={points:[],ambients:[]},this.surfaces=[]}return e.prototype.defaults={cullBackfaces:!0,projection:seen.Projections.perspective(-100,100,-100,100,100,300),viewport:seen.Viewports.centerOrigin(500,500)},e.prototype.startRenderLoop=function(t){return null==t&&(t=30),setInterval(this.render,t)},e.prototype.render=function(){var t;return this.dispatch.beforeRender(),t=this.renderSurfaces(),this.canvas.render(t),this.dispatch.afterRender({surfaces:t}),this},e.prototype.renderSurfaces=function(){var t,e=this;return t=this.projection.multiply(this.viewport),this.surfaces.length=0,this.group.eachTransformedShape(function(n,r){var s,i,o,u,a,h;for(a=n.surfaces,h=[],o=0,u=a.length;u>o;o++)i=a[o],s=i.getRenderSurface(r,t),!e.cullBackfaces||!i.cullBackfaces||s.projected.normal.z<0?(null!=i.fill&&(s.fill=e.shader.getFaceColor(e.lights,s.transformed,i.fill)),null!=i.stroke&&(s.stroke=i.stroke),h.push(e.surfaces.push(i))):h.push(void 0);return h}),this.surfaces.sort(function(t,e){return e.render.projected.barycenter.z-t.render.projected.barycenter.z}),this.surfaces},e}()}.call(this);